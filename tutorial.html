<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tutorial &mdash; PySCF 1.3 alpha documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.3 alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="PySCF 1.3 alpha documentation" href="index.html" />
    <link rel="next" title="Advanced topics" href="advanced.html" />
    <link rel="prev" title="An overview of PySCF" href="overview.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="advanced.html" title="Advanced topics"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="An overview of PySCF"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">PySCF 1.3 alpha documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tutorial">
<span id="getting-started"></span><h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="quick-setup">
<h2>Quick setup<a class="headerlink" href="#quick-setup" title="Permalink to this headline">¶</a></h2>
<p>The prerequisites of PySCF include <a class="reference external" href="http://www.cmake.org">cmake</a>,
<a class="reference external" href="http://www.numpy.org/">numpy</a>, <a class="reference external" href="http://www.scipy.org/">scipy</a>,
and <a class="reference external" href="http://www.h5py.org/">h5py</a>.  On the Ubuntu host, you can quickly
install them:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo apt-get install python-h5py python-scipy cmake
</pre></div>
</div>
<p>Then download the latest version of <a class="reference external" href="https://github.com/sunqm/pyscf.git/">pyscf</a>
and build C extensions in <tt class="file docutils literal"><span class="pre">pyscf/lib</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ git clone https://github.com/sunqm/pyscf
$ cd pyscf/lib
$ mkdir build
$ cd build
$ cmake ..
$ make
</pre></div>
</div>
<p>Finally, update the Python runtime path <tt class="code docutils literal"><span class="pre">PYTHONPATH</span></tt> (assuming pyscf
is put in /home/abc, replace it with your own path):</p>
<div class="highlight-python"><div class="highlight"><pre>$ echo &#39;export PYTHONPATH=/home/abc:$PYTHONPATH&#39; &gt;&gt; ~/.bashrc
$ source ~/.bashrc
</pre></div>
</div>
<p>To ensure the installation is successed, start a Python shell, and type:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyscf</span>
</pre></div>
</div>
<p>If you got errors like:</p>
<div class="highlight-python"><div class="highlight"><pre>ImportError: No module named pyscf
</pre></div>
</div>
<p>It&#8217;s very possible that you put <tt class="docutils literal"><span class="pre">/home/abc/pyscf</span></tt> in <tt class="code docutils literal"><span class="pre">PYTHONPATH</span></tt>.
You need to remove the <tt class="docutils literal"><span class="pre">/pyscf</span></tt> in that string and try
<tt class="docutils literal"><span class="pre">import</span> <span class="pre">pyscf</span></tt> in the python shell again.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The quick setup does not provide the best performance.
Please see <a class="reference internal" href="install.html#installing"><em>Installation</em></a> for the optimized libraries.</p>
</div>
</div>
<div class="section" id="a-simple-example">
<h2>A simple example<a class="headerlink" href="#a-simple-example" title="Permalink to this headline">¶</a></h2>
<p>Here is an example to run HF calculation for hydrogen molecule:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s">&#39;H 0 0 0; H 0 0 1.2&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s">&#39;cc-pvdz&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="go">converged SCF energy = -1.06111199785749</span>
<span class="go">-1.06111199786</span>
</pre></div>
</div>
</div>
<div class="section" id="input-molecule">
<h2>Input molecule<a class="headerlink" href="#input-molecule" title="Permalink to this headline">¶</a></h2>
<p>The first question is how to input a molecule in pyscf.  There are three
ways to define and build a molecule.  The first is to use the keyword
arguments of <tt class="xref py py-func docutils literal"><span class="pre">Mole.build()</span></tt> to initialize a molecule:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">atom</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;O 0 0 0; H  0 1 0; H 0 0 1&#39;&#39;&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">basis</span> <span class="o">=</span> <span class="s">&#39;sto-3g&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The second way is to assign the geometry, basis etc. to <tt class="xref py py-class docutils literal"><span class="pre">Mole</span></tt>
object, then call <tt class="xref py py-meth docutils literal"><span class="pre">build()</span></tt> function to initialize the
molecule:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;O 0 0 0; H  0 1 0; H 0 0 1&#39;&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s">&#39;sto-3g&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>The third way is to use the shortcut function <tt class="xref py py-func docutils literal"><span class="pre">Mole.M()</span></tt>.  This
function pass all arguments to <tt class="xref py py-func docutils literal"><span class="pre">Mole.build()</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">atom</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;O 0 0 0; H  0 1 0; H 0 0 1&#39;&#39;&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">basis</span> <span class="o">=</span> <span class="s">&#39;sto-3g&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Either way, you may have noticed two keywords <tt class="docutils literal"><span class="pre">atom</span></tt> and <tt class="docutils literal"><span class="pre">basis</span></tt>.
They are used to hold the molecular geometry and basis sets.</p>
<div class="section" id="geometry">
<h3>Geometry<a class="headerlink" href="#geometry" title="Permalink to this headline">¶</a></h3>
<p>There are two ways to insert the geometry. The internal format of
<tt class="xref py py-attr docutils literal"><span class="pre">Mole.atom</span></tt> is a python list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">atom</span> <span class="o">=</span> <span class="p">[[</span><span class="n">atom1</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)],</span>
        <span class="p">[</span><span class="n">atom2</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)],</span>
        <span class="o">...</span>
        <span class="p">[</span><span class="n">atomN</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)]]</span>
</pre></div>
</div>
<p>You can input the geometry in this format.  Therefore, you are able to
use all the possible feature provided by Python to construct the
geometry:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&#39;O&#39;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="p">[</span><span class="s">&#39;H&#39;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="p">[</span><span class="s">&#39;H&#39;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">extend</span><span class="p">([[</span><span class="s">&#39;H&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)])</span>
</pre></div>
</div>
<p>Although the internal format is defined on the Python list, you can
replace it with tuple, or numpy.ndarray for the coordinate part:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="p">[</span><span class="s">&#39;H&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;H&#39;</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
</pre></div>
</div>
<p>The second way is to assign <tt class="xref py py-attr docutils literal"><span class="pre">atom</span></tt> a string like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">O 0 0 0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">H 0 1 0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">H 0 0 1;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">+=</span> <span class="s">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;H &#39;</span><span class="o">+</span><span class="p">(</span><span class="s">&#39; </span><span class="si">%f</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)])</span>
</pre></div>
</div>
<p>There are a few requirements for the string format.  The string input
takes <tt class="docutils literal"><span class="pre">;</span></tt> or <tt class="docutils literal"><span class="pre">\n</span></tt> to partition atoms, and `` `` or <tt class="docutils literal"><span class="pre">,</span></tt> to divide
the atomic symbol and the coordinates.  Blank lines will be ignored.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Z-matrix string is not supported in the present version.</p>
</div>
<p>To specify the atoms type, you can use the atomic symbol (case-insensitive),
or the atomic nuclear charge:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">8</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="p">[</span><span class="s">&#39;h&#39;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="p">[</span><span class="s">&#39;H&#39;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]]</span>
</pre></div>
</div>
<p>If you want to label an atom to distinguish it from the rest, you can prefix
or suffix number or special characters <tt class="docutils literal"><span class="pre">1234567890~!&#64;#$%^&amp;*()_+.?:&lt;&gt;[]{}|</span></tt>
(execept <tt class="docutils literal"><span class="pre">,</span></tt> and <tt class="docutils literal"><span class="pre">;</span></tt>) to an atomic symbol.  With this decoration, you can
specify a basis set, or mass, or nuclear model for a particular atom
without affect the rest same type atoms:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;8 0 0 0; h:1 0 1 0; H@2 0 0&#39;&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;O&#39;</span><span class="p">:</span> <span class="s">&#39;sto-3g&#39;</span><span class="p">,</span> <span class="s">&#39;H&#39;</span><span class="p">:</span> <span class="s">&#39;cc-pvdz&#39;</span><span class="p">,</span> <span class="s">&#39;H@2&#39;</span><span class="p">:</span> <span class="s">&#39;6-31G&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span>
<span class="go">[[&#39;O&#39;, [0.0, 0.0, 0.0]], [&#39;H:1&#39;, [0.0, 1.0, 0.0]], [&#39;H@2&#39;, [0.0, 0.0]]]</span>
</pre></div>
</div>
<p>No matter which format or symbol used for the input, <tt class="xref py py-func docutils literal"><span class="pre">Mole.build()</span></tt>
will convert <tt class="xref py py-attr docutils literal"><span class="pre">Mole.atom</span></tt> to the internal format:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="go">    O        0,   0, 0             ; 1 0.0 1 0</span>

<span class="go">        H@2,0 0 1</span>
<span class="go">    &#39;&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span>
<span class="go">[[&#39;O&#39;, [0.0, 0.0, 0.0]], [&#39;H&#39;, [0.0, 1.0, 0.0]], [&#39;H@2&#39;, [0.0, 0.0, 1.0]]]</span>
</pre></div>
</div>
</div>
<div class="section" id="basis-set">
<h3>Basis set<a class="headerlink" href="#basis-set" title="Permalink to this headline">¶</a></h3>
<p>There are four ways to assign basis sets.  One is to input the intenal format:</p>
<div class="highlight-python"><div class="highlight"><pre>basis = {atom_type1:[[angular_momentum
                      (GTO-exp1, contract-coeff11, contract-coeff12),
                      (GTO-exp2, contract-coeff21, contract-coeff22),
                      (GTO-exp3, contract-coeff31, contract-coeff32),
                      ...],
                     [angular_momentum
                      (GTO-exp1, contract-coeff11, contract-coeff12),
                      ...],
                     ...],
         atom_type2:[[angular_momentum, (...),],
                     ...],
</pre></div>
</div>
<p>like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;H&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span>
                    <span class="p">(</span><span class="mf">19.2406000</span><span class="p">,</span> <span class="mf">0.0328280</span><span class="p">),</span>
                    <span class="p">(</span><span class="mf">2.8992000</span><span class="p">,</span> <span class="mf">0.2312080</span><span class="p">),</span>
                    <span class="p">(</span><span class="mf">0.6534000</span><span class="p">,</span> <span class="mf">0.8172380</span><span class="p">),],</span>
                   <span class="p">[</span><span class="mi">0</span><span class="p">,</span>
                    <span class="p">(</span><span class="mf">0.1776000</span><span class="p">,</span> <span class="mf">1.0000000</span><span class="p">),],</span>
                   <span class="p">[</span><span class="mi">1</span><span class="p">,</span>
                    <span class="p">(</span><span class="mf">1.0000000</span><span class="p">,</span> <span class="mf">1.0000000</span><span class="p">),]],</span>
            <span class="p">}</span>
</pre></div>
</div>
<p>You can find more examples of internal format in <tt class="file docutils literal"><span class="pre">pyscf/gto/basis/</span></tt>.
Some basis sets, e.g.  <tt class="file docutils literal"><span class="pre">dzp_dunning.py</span></tt>, are saved in the internal
format.</p>
<p>But the internal format is not easy to input.  So two functions
<tt class="xref py py-func docutils literal"><span class="pre">basis.load()</span></tt> and <tt class="xref py py-func docutils literal"><span class="pre">basis.parse()</span></tt> are defined to simplify the
workload.  They return the basis set of internal format:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;H&#39;</span><span class="p">:</span> <span class="n">gto</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;sto3g&#39;</span><span class="p">,</span> <span class="s">&#39;H&#39;</span><span class="p">)}</span>
</pre></div>
</div>
<p><tt class="xref py py-func docutils literal"><span class="pre">basis.parse()</span></tt> can parse a basis string of NWChem format
(<a class="reference external" href="https://bse.pnl.gov/bse/portal">https://bse.pnl.gov/bse/portal</a>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;O&#39;</span><span class="p">:</span> <span class="n">gto</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">C    S</span>
<span class="s">     71.6168370              0.15432897</span>
<span class="s">     13.0450960              0.53532814</span>
<span class="s">      3.5305122              0.44463454</span>
<span class="s">C    SP</span>
<span class="s">      2.9412494             -0.09996723             0.15591627</span>
<span class="s">      0.6834831              0.39951283             0.60768372</span>
<span class="s">      0.2222899              0.70011547             0.39195739</span>
<span class="s">&#39;&#39;&#39;</span><span class="p">)}</span>
</pre></div>
</div>
<p>Things can be more convenient by inputing name of the baiss:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;O&#39;</span><span class="p">:</span> <span class="s">&#39;sto3g&#39;</span><span class="p">,</span> <span class="s">&#39;H&#39;</span><span class="p">:</span> <span class="s">&#39;6-31g&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>or specify one basis set universally for all atoms:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s">&#39;6-31g&#39;</span>
</pre></div>
</div>
<p>The package defined a 0-nuclear-charge atom, called &#8220;GHOST&#8221;.  This phantom
atom can be used to insert basis for BSSE correction with
<tt class="xref py py-func docutils literal"><span class="pre">basis.load()</span></tt> and <tt class="xref py py-func docutils literal"><span class="pre">basis.parse()</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;GHOST&#39;</span><span class="p">:</span> <span class="n">gto</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;cc-pvdz&#39;</span><span class="p">,</span> <span class="s">&#39;O&#39;</span><span class="p">),</span> <span class="s">&#39;H&#39;</span><span class="p">:</span> <span class="s">&#39;sto3g&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Like the requirements of geometry input, you can use atomic symbol
(case-insensitive) or the atomic nuclear charge, as the keyword of the
<tt class="xref py py-attr docutils literal"><span class="pre">basis</span></tt> dict.  Prefix and suffix of numbers and special
characters are allowed.  If the decorated atomic symbol is appeared in
<tt class="xref py py-attr docutils literal"><span class="pre">atom</span></tt> but not <tt class="xref py py-attr docutils literal"><span class="pre">basis</span></tt>, the basis parser will
remove all decorations then seek the pure atomic symbol in
<tt class="xref py py-attr docutils literal"><span class="pre">basis</span></tt> dict.  In the following example, <tt class="docutils literal"><span class="pre">6-31G</span></tt> basis
will be assigned to the second H atom, but <tt class="docutils literal"><span class="pre">STO-3G</span></tt> will be used for
the third atom:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">8</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="p">[</span><span class="s">&#39;h1&#39;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="p">[</span><span class="s">&#39;H2&#39;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]]</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;O&#39;</span><span class="p">:</span> <span class="s">&#39;sto-3g&#39;</span><span class="p">,</span> <span class="s">&#39;H&#39;</span><span class="p">:</span> <span class="s">&#39;sto3g&#39;</span><span class="p">,</span> <span class="s">&#39;H1&#39;</span><span class="p">:</span> <span class="s">&#39;6-31G&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="other-parameters">
<h3>Other parameters<a class="headerlink" href="#other-parameters" title="Permalink to this headline">¶</a></h3>
<p>You can assign more infomations to a molecular object:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mol</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mol</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mol</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mol</span><span class="o">.</span><span class="n">nucmod</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;O1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">mol</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;O1&#39;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s">&#39;H&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><tt class="xref py py-attr docutils literal"><span class="pre">Mole.spin</span></tt> is <em>2S</em>, the alpha and beta electron number difference.</p>
</div>
<p><tt class="xref py py-class docutils literal"><span class="pre">Mole</span></tt> also defines some global options.  You can control the
print level with <tt class="xref py py-attr docutils literal"><span class="pre">verbose</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mol</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>
</div>
<p>The print level can be 0 (quite, no output) to 9 (very noise).  Mostly,
the useful messages are printed at level 4 (info), and 5 (debug).
You can also specify the place where to write the print messages:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mol</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="s">&#39;path/to/my_log.txt&#39;</span>
</pre></div>
</div>
<p>Without assigning this variable, messages will be printed to
<tt class="xref py py-attr docutils literal"><span class="pre">sys.stdout</span></tt>.  You can control the memory usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mol</span><span class="o">.</span><span class="n">max_memory</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c"># MB</span>
</pre></div>
</div>
<p>The default size can be set in shell with environment variable <cite>PYSCF_MAX_MEMORY</cite></p>
<p><tt class="xref py py-attr docutils literal"><span class="pre">verbose</span></tt>, <tt class="xref py py-attr docutils literal"><span class="pre">output</span></tt> and <tt class="xref py py-attr docutils literal"><span class="pre">max_memory</span></tt>
can be assgined from command line:</p>
<div class="highlight-python"><div class="highlight"><pre>$ python example.py --verbose -o /path/to/my_log.txt -m 1000
</pre></div>
</div>
<p>The command line arguments are parsed in <tt class="xref py py-func docutils literal"><span class="pre">Mole.build()</span></tt>.  By
default, they have the highest priority, which means our settings in the
script will be overwritten by the command line arguments.  To prevent
that, we can call <tt class="xref py py-func docutils literal"><span class="pre">Mole.build()</span></tt> with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>The first 0 prevent <tt class="xref py py-func docutils literal"><span class="pre">build()</span></tt> dumping the input file.  The
second 0 prevent <tt class="xref py py-func docutils literal"><span class="pre">build()</span></tt> parsing command line.</p>
</div>
</div>
<div class="section" id="hf-mp2-mcscf">
<h2>HF, MP2, MCSCF<a class="headerlink" href="#hf-mp2-mcscf" title="Permalink to this headline">¶</a></h2>
<div class="section" id="hartree-fock">
<h3>Hartree-Fock<a class="headerlink" href="#hartree-fock" title="Permalink to this headline">¶</a></h3>
<p>Now we are ready to study electronic structure theory with pyscf.  Let&#8217;s
take oxygen molecule as the first example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="s">&#39;o2.log&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s">&#39;O 0 0 0; O 0 0 1.2&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s">&#39;ccpvdz&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>Import non-relativistic Hartree-Fock:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">scf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;E(HF) = </span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">m</span><span class="o">.</span><span class="n">kernel</span><span class="p">())</span>
<span class="go">E(HF) = -149.544214749</span>
</pre></div>
</div>
<p>But the ground state of oxygen molecule should be triplet:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">o2_tri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o2_tri</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o2_tri</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c"># two &quot;0&quot;s to prevent dumping input and parsing command line</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rhf3</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">o2_tri</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">rhf3</span><span class="o">.</span><span class="n">kernel</span><span class="p">())</span>
<span class="go">-149.609461122</span>
</pre></div>
</div>
<p>or run with UHF:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">uhf3</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">o2_tri</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">uhf3</span><span class="o">.</span><span class="n">scf</span><span class="p">())</span>
<span class="go">-149.628992314</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;S^2 = </span><span class="si">%f</span><span class="s">, 2S+1 = </span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">uhf3</span><span class="o">.</span><span class="n">spin_square</span><span class="p">())</span>
<span class="go">S^2 = 2.032647, 2S+1 = 3.021686</span>
</pre></div>
</div>
<p>where we called <tt class="xref py py-func docutils literal"><span class="pre">mf.scf()</span></tt>, which is an alias name of <tt class="docutils literal"><span class="pre">mf.kernel</span></tt>.
You can impose symmetry:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">o2_sym</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o2_sym</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o2_sym</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o2_sym</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rhf3_sym</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">o2_sym</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">rhf3_sym</span><span class="o">.</span><span class="n">kernel</span><span class="p">())</span>
<span class="go">-149.609461122</span>
</pre></div>
</div>
<p>Here we rebuild the moleclue because the point group symmetry
information, symmetry adapted orbitals, are initalized in
<tt class="xref py py-meth docutils literal"><span class="pre">Mole.build()</span></tt>.  With a little more lines of code, we can check the
occupancy for each irreducible representations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">symm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">myocc</span><span class="p">(</span><span class="n">mf</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">mol</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">mol</span>
<span class="gp">... </span>    <span class="n">irrep_id</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">irrep_id</span>
<span class="gp">... </span>    <span class="n">so</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">symm_orb</span>
<span class="gp">... </span>    <span class="n">orbsym</span> <span class="o">=</span> <span class="n">symm</span><span class="o">.</span><span class="n">label_orb_symm</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">irrep_id</span><span class="p">,</span> <span class="n">so</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">doccsym</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">orbsym</span><span class="p">)[</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span><span class="o">==</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">soccsym</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">orbsym</span><span class="p">)[</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">ir</span><span class="p">,</span><span class="n">irname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">irrep_name</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">, double-occ = </span><span class="si">%d</span><span class="s">, single-occ = </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span>
<span class="gp">... </span>              <span class="p">(</span><span class="n">irname</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">doccsym</span><span class="o">==</span><span class="n">ir</span><span class="p">),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">soccsym</span><span class="o">==</span><span class="n">ir</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">myocc</span><span class="p">(</span><span class="n">rhf3_sym</span><span class="p">)</span>
<span class="go">Ag, double-occ = 3, single-occ = 0</span>
<span class="go">B1g, double-occ = 0, single-occ = 0</span>
<span class="go">B2g, double-occ = 0, single-occ = 1</span>
<span class="go">B3g, double-occ = 0, single-occ = 1</span>
<span class="go">Au, double-occ = 0, single-occ = 0</span>
<span class="go">B1u, double-occ = 2, single-occ = 0</span>
<span class="go">B2u, double-occ = 1, single-occ = 0</span>
<span class="go">B3u, double-occ = 1, single-occ = 0</span>
</pre></div>
</div>
<p>To label the irreducible representation of given orbitals,
<tt class="xref py py-func docutils literal"><span class="pre">symm.label_orb_symm()</span></tt> needs the information of the point group
symmetry which are initialized in <tt class="docutils literal"><span class="pre">mol</span></tt> object, including the <cite>id</cite> of
irreducible representations <tt class="xref py py-attr docutils literal"><span class="pre">Mole.irrep_id</span></tt> and the symmetry
adapted basis <tt class="xref py py-attr docutils literal"><span class="pre">Mole.symm_orb</span></tt>.  For each <tt class="xref py py-attr docutils literal"><span class="pre">irrep_id</span></tt>,
<tt class="xref py py-attr docutils literal"><span class="pre">Mole.irrep_name</span></tt> gives the associated irrep symbol (A1, B1 ...).
In the SCF calculation, you can control the symmetry of the wave
function by assigning electron numbers <cite>(alpha,beta)</cite> for particular irreps:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">rhf3_sym</span><span class="o">.</span><span class="n">irrep_nelec</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;B2g&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="s">&#39;B3g&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="s">&#39;B2u&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s">&#39;B3u&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rhf3_sym</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">rhf3_sym</span><span class="o">.</span><span class="n">kernel</span><span class="p">())</span>
<span class="go">-148.983117701</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rhf3_sym</span><span class="o">.</span><span class="n">get_irrep_nelec</span><span class="p">()</span>
<span class="go">{&#39;Ag&#39; : (3, 3), &#39;B1g&#39;: (0, 0), &#39;B2g&#39;: (1, 1), &#39;B3g&#39;: (1, 1), &#39;Au&#39; : (0, 0), &#39;B1u&#39;: (1, 0), &#39;B2u&#39;: (0, 1), &#39;B3u&#39;: (1, 0)}</span>
</pre></div>
</div>
<p>More informations can be found in the output file &#8220;o2.log&#8221;.</p>
</div>
<div class="section" id="mp2-and-mo-integral-transformation">
<h3>MP2 and MO integral transformation<a class="headerlink" href="#mp2-and-mo-integral-transformation" title="Permalink to this headline">¶</a></h3>
<p>Next, we compute the correlation energy with <tt class="xref py py-mod docutils literal"><span class="pre">mp.mp2</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">mp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mp2</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">MP2</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;E(MP2) = </span><span class="si">%.9g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">m</span><span class="o">.</span><span class="n">kernel</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">E(MP2) = -0.379359288</span>
</pre></div>
</div>
<p>This is the correlation energy of singlet ground state.  For the triplet
state, we can write our own function to compute the MP2 correlation energy</p>
<div class="math">
\[E_{corr} = \frac{1}{4}\sum_{ijab}
         \frac{\langle ij||ab \rangle \langle ab||ij \rangle}
         {\epsilon_i + \epsilon_j - \epsilon_a - \epsilon_b}\]</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">myump2</span><span class="p">(</span><span class="n">mf</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span>
    <span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">ao2mo</span>
    <span class="c"># As UHF objects, mo_energy, mo_occ, mo_coeff are two-item lists</span>
    <span class="c"># (the first item for alpha spin, the second for beta spin).</span>
    <span class="n">mo_energy</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_energy</span>
    <span class="n">mo_occ</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span>
    <span class="n">mo_coeff</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mo_coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span><span class="n">mo_coeff</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mo_coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">],</span><span class="n">mo_coeff</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">eo</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">ev</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">],</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">no</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">nv</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">noa</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">nva</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">eri</span> <span class="o">=</span> <span class="n">ao2mo</span><span class="o">.</span><span class="n">general</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">o</span><span class="p">,</span><span class="n">v</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">no</span><span class="p">,</span><span class="n">nv</span><span class="p">,</span><span class="n">no</span><span class="p">,</span><span class="n">nv</span><span class="p">)</span>
    <span class="n">eri</span><span class="p">[:</span><span class="n">noa</span><span class="p">,</span><span class="n">nva</span><span class="p">:]</span> <span class="o">=</span> <span class="n">eri</span><span class="p">[</span><span class="n">noa</span><span class="p">:,:</span><span class="n">nva</span><span class="p">]</span> <span class="o">=</span> <span class="n">eri</span><span class="p">[:,:,:</span><span class="n">noa</span><span class="p">,</span><span class="n">nva</span><span class="p">:]</span> <span class="o">=</span> <span class="n">eri</span><span class="p">[:,:,</span><span class="n">noa</span><span class="p">:,:</span><span class="n">nva</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">eri</span> <span class="o">-</span> <span class="n">eri</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">eov</span> <span class="o">=</span> <span class="n">eo</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">ev</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">de</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">eov</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">eov</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">emp2</span> <span class="o">=</span> <span class="o">.</span><span class="mi">25</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s">&#39;iajb,iajb,iajb-&gt;&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">de</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">emp2</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;E(UMP2) = </span><span class="si">%.9g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">myump2</span><span class="p">(</span><span class="n">uhf3</span><span class="p">))</span>
<span class="go">-0.346926068</span>
</pre></div>
</div>
<p>In this example, we concatenate <span class="math">\(\alpha\)</span> and <span class="math">\(\beta\)</span>
orbitals to fake the spin-orbitals.  After integral transformation, we
zerod out the integrals of different spin.  Here, the <tt class="xref py py-mod docutils literal"><span class="pre">ao2mo</span></tt>
module provides the general 2-electron MO integral transformation.
Using this module, you are able to do <em>arbitrary</em> integral
transformation for <em>arbitrary</em> integrals. For example, the following
code gives the <tt class="docutils literal"><span class="pre">(ov|vv)</span></tt> type integrals:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">ao2mo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">h5py</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mocc</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">[:,</span><span class="n">m</span><span class="o">.</span><span class="n">mo_occ</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mvir</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">[:,</span><span class="n">m</span><span class="o">.</span><span class="n">mo_occ</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ao2mo</span><span class="o">.</span><span class="n">general</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="p">(</span><span class="n">mocc</span><span class="p">,</span><span class="n">mvir</span><span class="p">,</span><span class="n">mvir</span><span class="p">,</span><span class="n">mvir</span><span class="p">),</span> <span class="s">&#39;tmp.h5&#39;</span><span class="p">,</span> <span class="n">compact</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feri</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s">&#39;tmp.h5&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ovvv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">feri</span><span class="p">[</span><span class="s">&#39;eri_mo&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">ovvv</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(160, 400)</span>
</pre></div>
</div>
<p>We pass <tt class="docutils literal"><span class="pre">compact=False</span></tt> to <tt class="xref py py-func docutils literal"><span class="pre">ao2mo.general()</span></tt> to prevent the
function using the permutation symmetry between the virtual-virtual pair
of <tt class="docutils literal"><span class="pre">|vv)</span></tt>.  So the shape of <tt class="docutils literal"><span class="pre">ovvv</span></tt> corresponds to 8 occupied
orbitals by 20 virtual orbitals for electron 1 <tt class="docutils literal"><span class="pre">(ov|</span></tt> and 20 by 20 for
electron 2 <tt class="docutils literal"><span class="pre">|vv)</span></tt>.  In the following example, we transformed the
analytical gradients of 2-electron integrals</p>
<div class="math">
\[\langle (\frac{\partial}{\partial R} \varphi_i) \varphi_k | \varphi_j \varphi_l \rangle
= \int \frac{\frac{\partial\varphi_i(r_1)}{\partial R}
\varphi_j(r_1) \varphi_k(r_2)\varphi_l(r_2)}{|r_1-r_2|} dr_1 dr_2\]</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">nocc</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">nelectron</span> <span class="o">//</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">co</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">[:,:</span><span class="n">nocc</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cv</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">[:,</span><span class="n">nocc</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nvir</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eri</span> <span class="o">=</span> <span class="n">ao2mo</span><span class="o">.</span><span class="n">general</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="p">(</span><span class="n">co</span><span class="p">,</span><span class="n">cv</span><span class="p">,</span><span class="n">co</span><span class="p">,</span><span class="n">cv</span><span class="p">),</span> <span class="n">intor</span><span class="o">=</span><span class="s">&#39;cint2e_ip1_sph&#39;</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eri</span> <span class="o">=</span> <span class="n">eri</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">nocc</span><span class="p">,</span> <span class="n">nvir</span><span class="p">,</span> <span class="n">nocc</span><span class="p">,</span> <span class="n">nvir</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">eri</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(3, 8, 20, 8, 20)</span>
</pre></div>
</div>
</div>
<div class="section" id="casci-and-casscf">
<h3>CASCI and CASSCF<a class="headerlink" href="#casci-and-casscf" title="Permalink to this headline">¶</a></h3>
<p>The two classes <tt class="xref py py-class docutils literal"><span class="pre">mcscf.CASCI</span></tt> and <tt class="xref py py-class docutils literal"><span class="pre">mcscf.CASSCF</span></tt> provided
by <tt class="xref py py-mod docutils literal"><span class="pre">mcscf</span></tt> have the same initialization structure:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">mcscf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASCI</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;E(CASCI) = </span><span class="si">%.9g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">mc</span><span class="o">.</span><span class="n">casci</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">E(CASCI) = -149.601051</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;E(CASSCF) = </span><span class="si">%.9g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">mc</span><span class="o">.</span><span class="n">kernel</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">E(CASSCF) = -149.613191</span>
</pre></div>
</div>
<p>In this example, the CAS space is (6e, 4o): the third argument for
CASCI/CASSCF is the size of CAS space; the fourth argument is the number
of electrons.  By default, the CAS solver splits the electron number
according to the <tt class="xref py py-attr docutils literal"><span class="pre">Mole.spin</span></tt> attribute.  In the above example, the
number of alpha electron is equal to the number of beta electrons, since
the <tt class="docutils literal"><span class="pre">mol</span></tt> object is initialized with <tt class="docutils literal"><span class="pre">spin=0</span></tt>.  The spin
multiplicity of the CASSCF/CASCI solver can be changed by the fourth
argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;E(CASSCF) = </span><span class="si">%.9g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">mc</span><span class="o">.</span><span class="n">kernel</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">E(CASSCF) = -149.609461</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;S^2 = </span><span class="si">%.7f</span><span class="s">, 2S+1 = </span><span class="si">%.7f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">spin_square</span><span class="p">(</span><span class="n">mc</span><span class="p">))</span>
<span class="go">S^2 = 2.0000000, 2S+1 = 3.0000000</span>
</pre></div>
</div>
<p>The two integers in tuple stand for the number of alpha and beta
electrons.  Although it is a triplet state, the solution might not be
right since the CASSCF is based on the incorrect singlet HF ground
state.  Using the ROHF ground state, we have:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">rhf3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;E(CASSCF) = </span><span class="si">%.9g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">mc</span><span class="o">.</span><span class="n">mc1step</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">E(CASSCF) = -149.646746</span>
</pre></div>
</div>
<p>where we called <tt class="xref py py-func docutils literal"><span class="pre">mf.mc1step()</span></tt>, which is an alias name of <tt class="docutils literal"><span class="pre">mc.kernel</span></tt>.
The energy is lower than the RHF based wavefunction. Alternatively, we
can also use the UHF ground state to start a CASSCF calculation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">uhf3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;E(CASSCF) = </span><span class="si">%.9g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">mc</span><span class="o">.</span><span class="n">kernel</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">E(CASSCF) = -149.661324</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s">&#39;S^2 = </span><span class="si">%.7f</span><span class="s">, 2S+1 = </span><span class="si">%.7f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">spin_square</span><span class="p">(</span><span class="n">mc</span><span class="p">))</span>
<span class="go">S^2 = 3.9713105, 2S+1 = 4.1091656</span>
</pre></div>
</div>
<p>Woo, the total energy is even lower.  But the spin is contaminated.</p>
</div>
</div>
<div class="section" id="restore-previous-calculation">
<h2>Restore previous calculation<a class="headerlink" href="#restore-previous-calculation" title="Permalink to this headline">¶</a></h2>
<p>There is no <cite>restart</cite> mechanism in this package.  Alternatively,
calculations can be &#8220;restored&#8221; by proper initial guess.  The initial
guess can be prepared in many ways.  One is to read the <tt class="docutils literal"><span class="pre">chkpoint</span></tt> file
which is generated in the previous or the other computations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">scf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">chkfile</span> <span class="o">=</span> <span class="s">&#39;/path/to/chkfile&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">init_guess</span> <span class="o">=</span> <span class="s">&#39;chkfile&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">/path/to/chkfile</span></tt> can be found in the output of the other calculation
(if mol.verbose &gt;= 4, there is an entry &#8220;chkfile to save SCF result&#8221; to
record the name of chkfile in the output).  By setting
<tt class="xref py py-attr docutils literal"><span class="pre">chkfile</span></tt> and <tt class="xref py py-attr docutils literal"><span class="pre">init_guess</span></tt>, the SCF module can read the
molecular orbitals stored in the given <tt class="xref py py-attr docutils literal"><span class="pre">chkfile</span></tt> and rotate them to
the proper basis sets.  There is another way to read the initial guess:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">scf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">hf</span><span class="o">.</span><span class="n">from_chk</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="s">&#39;/path/to/chkfile&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span>
</pre></div>
</div>
<p><tt class="xref py py-func docutils literal"><span class="pre">scf.hf.from_chk()</span></tt> reads the chkpoint file and generated the
corresponding density matrix.  The density matrix is then
feed to <tt class="xref py py-func docutils literal"><span class="pre">mf.kernel()</span></tt>, which takes one parameter as the start point
for SCF loops.</p>
<p>The &#8220;chkfile&#8221; is not limited to the calculation based on the same
molecular and same basis set.  One can also first do a cheap SCF (with
small basis sets) or a model SCF (dropping a few atoms, or charged
system), then use <tt class="xref py py-func docutils literal"><span class="pre">scf.hf.from_chk()</span></tt> to project the
results to the target basis sets.  <a class="reference internal" href="scf.html#module-scf" title="scf: restricted and unrestricted, closed shell and open shell Hartree-Fock methods"><tt class="xref py py-mod docutils literal"><span class="pre">scf</span></tt></a> provides other initial
guess methods such as <tt class="xref py py-func docutils literal"><span class="pre">scf.hf.init_guess_by_minao()</span></tt>,
<tt class="xref py py-func docutils literal"><span class="pre">scf.hf.init_guess_by_atom()</span></tt>, <tt class="xref py py-func docutils literal"><span class="pre">scf.hf.init_guess_by_1e()</span></tt> (you
can use <tt class="xref py py-func docutils literal"><span class="pre">scf.hf.get_init_guess()</span></tt> function to call them).  If you
like, you can mix all kinds of methods to make a initial guess for
density matrix and feed it to <tt class="xref py py-func docutils literal"><span class="pre">mf.scf()</span></tt></p>
<p>To restore CASSCF calculation, you need prepare either CASSCF orbitals
or CI coefficients (not that useful unless doing DMRG-CASSCF) or both.
For instance, see <tt class="docutils literal"><span class="pre">pyscf/examples/mcscf/13-restart.py</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c">#</span>
<span class="c"># Author: Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c">#</span>

<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">mcscf</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">lib</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Restart CASSCF from previous calculation.</span>

<span class="sd">There is no &quot;restart&quot; keyword for CASSCF solver.  The CASSCF solver is</span>
<span class="sd">completely controlled by initial guess.  So we can mimic the restart feature</span>
<span class="sd">by providing proper initial guess from previous calculation.</span>

<span class="sd">We need assign the .chkfile a string to indicate the file where to save the</span>
<span class="sd">CASSCF intermediate results.  Then we can &quot;restart&quot; the calculation from the</span>
<span class="sd">intermediate results.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">tmpchk</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">()</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s">&#39;C 0 0 0; C 0 0 1.2&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s">&#39;ccpvdz&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">chkfile</span> <span class="o">=</span> <span class="n">tmpchk</span><span class="o">.</span><span class="n">name</span>
<span class="n">mc</span><span class="o">.</span><span class="n">max_cycle_macro</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mc</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c">#######################################################################</span>
<span class="c">#</span>
<span class="c"># Assuming the CASSCF was interrupted.  Intermediate data were saved in</span>
<span class="c"># tmpchk file.  Here we read the chkfile to restart the previous calculation.</span>
<span class="c">#</span>
<span class="c">#######################################################################</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s">&#39;C 0 0 0; C 0 0 1.2&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s">&#39;ccpvdz&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">),</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">mo</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">chkfile</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">tmpchk</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;mcscf/mo_coeff&#39;</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="access-ao-integrals">
<h2>Access AO integrals<a class="headerlink" href="#access-ao-integrals" title="Permalink to this headline">¶</a></h2>
<div class="section" id="libcint-interface">
<h3>Libcint interface<a class="headerlink" href="#libcint-interface" title="Permalink to this headline">¶</a></h3>
<p>Pyscf uses <a class="reference external" href="https://github.com/sunqm/libcint">Libcint</a> library as the AO
integral backend.  It provides simple interface functon <tt class="xref py py-func docutils literal"><span class="pre">getints_by_shell()</span></tt>
to call the functions provided by <tt class="docutils literal"><span class="pre">Libcint</span></tt>.  Now let&#8217;s try to access
3-center 2-electron integrals through the interface:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">df</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s">&#39;O 0 0 0; h 0 -0.757 0.587; h 0 0.757 0.587&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s">&#39;cc-pvdz&#39;</span><span class="p">)</span>
<span class="n">auxmol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s">&#39;O 0 0 0; h 0 -0.757 0.587; h 0 0.757 0.587&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s">&#39;weigend&#39;</span><span class="p">)</span>
<span class="n">atm</span><span class="p">,</span> <span class="n">bas</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">conc_env</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">_env</span><span class="p">,</span> <span class="n">auxmol</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="n">auxmol</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="n">auxmol</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>
<span class="n">nao</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">nao_nr</span><span class="p">()</span>
<span class="n">naux</span> <span class="o">=</span> <span class="n">auxmol</span><span class="o">.</span><span class="n">nao_nr</span><span class="p">()</span>
<span class="n">eri3c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nao</span><span class="p">,</span><span class="n">nao</span><span class="p">,</span><span class="n">naux</span><span class="p">))</span>
<span class="n">pi</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">):</span>
    <span class="n">pj</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">):</span>
        <span class="n">pk</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="o">+</span><span class="n">auxmol</span><span class="o">.</span><span class="n">nbas</span><span class="p">):</span>
            <span class="n">shls</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">getints_by_shell</span><span class="p">(</span><span class="s">&#39;cint3c2e_sph&#39;</span><span class="p">,</span> <span class="n">shls</span><span class="p">,</span> <span class="n">atm</span><span class="p">,</span> <span class="n">bas</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
            <span class="n">di</span><span class="p">,</span> <span class="n">dj</span><span class="p">,</span> <span class="n">dk</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">eri3c</span><span class="p">[</span><span class="n">pi</span><span class="p">:</span><span class="n">pi</span><span class="o">+</span><span class="n">di</span><span class="p">,</span><span class="n">pj</span><span class="p">:</span><span class="n">pj</span><span class="o">+</span><span class="n">dj</span><span class="p">,</span><span class="n">pk</span><span class="p">:</span><span class="n">pk</span><span class="o">+</span><span class="n">dk</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf</span>
            <span class="n">pk</span> <span class="o">+=</span> <span class="n">dk</span>
        <span class="n">pj</span> <span class="o">+=</span> <span class="n">dj</span>
    <span class="n">pi</span> <span class="o">+=</span> <span class="n">di</span>
</pre></div>
</div>
<p>Here we first read in the Weigend density fitting basis to <tt class="docutils literal"><span class="pre">auxmol</span></tt>.  In
libcint, all integral functions requires the same input arguments,
<tt class="docutils literal"><span class="pre">(buf,</span> <span class="pre">shells,</span> <span class="pre">atm,</span> <span class="pre">bas,</span> <span class="pre">env,</span> <span class="pre">opt)</span></tt>.  So we use <tt class="xref py py-func docutils literal"><span class="pre">gto.conc_env()</span></tt>
to concatenate the AO basis and the auxiliary fitting basis, and
obtain one set of input arguments <tt class="docutils literal"><span class="pre">atm,</span> <span class="pre">bas,</span> <span class="pre">env</span></tt>.  In the resultant
<tt class="docutils literal"><span class="pre">bas</span></tt>, the first <tt class="docutils literal"><span class="pre">mol.nbas</span></tt> entries store the AO basis, and the following
<tt class="docutils literal"><span class="pre">auxmol.nbas</span></tt> are auxiliary basis.  Then the three nested loops run over all
integrals for the three index integral <cite>(ij|K)</cite>.  Next, we compute the two
center integrals:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">eri2c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">naux</span><span class="p">,</span><span class="n">naux</span><span class="p">))</span>
<span class="n">pk</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="o">+</span><span class="n">auxmol</span><span class="o">.</span><span class="n">nbas</span><span class="p">):</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="o">+</span><span class="n">auxmol</span><span class="o">.</span><span class="n">nbas</span><span class="p">):</span>
        <span class="n">shls</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">getints_by_shell</span><span class="p">(</span><span class="s">&#39;cint2c2e_sph&#39;</span><span class="p">,</span> <span class="n">shls</span><span class="p">,</span> <span class="n">atm</span><span class="p">,</span> <span class="n">bas</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">dk</span><span class="p">,</span> <span class="n">dl</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">eri2c</span><span class="p">[</span><span class="n">pk</span><span class="p">:</span><span class="n">pk</span><span class="o">+</span><span class="n">dk</span><span class="p">,</span><span class="n">pl</span><span class="p">:</span><span class="n">pl</span><span class="o">+</span><span class="n">dl</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf</span>
        <span class="n">pl</span> <span class="o">+=</span> <span class="n">dl</span>
    <span class="n">pk</span> <span class="o">+=</span> <span class="n">dk</span>
</pre></div>
</div>
<p>Yes, we are ready to implement our own density fitting Hartree-Fock now!</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get_vhf</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">naux</span> <span class="o">=</span> <span class="n">eri2c</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nao</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">nao_nr</span><span class="p">()</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s">&#39;ijp,ij-&gt;p&#39;</span><span class="p">,</span> <span class="n">eri3c</span><span class="p">,</span> <span class="n">dm</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">eri2c</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>
    <span class="n">jmat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s">&#39;p,ijp-&gt;ij&#39;</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">eri3c</span><span class="p">)</span>
    <span class="n">kpj</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s">&#39;ijp,jk-&gt;ikp&#39;</span><span class="p">,</span> <span class="n">eri3c</span><span class="p">,</span> <span class="n">dm</span><span class="p">)</span>
    <span class="n">pik</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">eri2c</span><span class="p">,</span> <span class="n">kpj</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">naux</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">kmat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s">&#39;pik,kjp-&gt;ij&#39;</span><span class="p">,</span> <span class="n">pik</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">naux</span><span class="p">,</span><span class="n">nao</span><span class="p">,</span><span class="n">nao</span><span class="p">),</span> <span class="n">eri3c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jmat</span> <span class="o">-</span> <span class="n">kmat</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">mf</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">mf</span><span class="o">.</span><span class="n">get_veff</span> <span class="o">=</span> <span class="n">get_vhf</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;E(DF-HF) = </span><span class="si">%.12f</span><span class="s">, ref = </span><span class="si">%.12f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">(),</span> <span class="n">scf</span><span class="o">.</span><span class="n">density_fit</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span><span class="o">.</span><span class="n">kernel</span><span class="p">()))</span>
</pre></div>
</div>
<p>Hopefully, your screen will print out</p>
<blockquote>
<div><div class="line-block">
<div class="line">E(DF-HF) = -76.025936299702, ref = -76.025936299702</div>
</div>
</div></blockquote>
<p>as mine.</p>
</div>
<div class="section" id="one-electron-ao-integrals">
<h3>One electron AO integrals<a class="headerlink" href="#one-electron-ao-integrals" title="Permalink to this headline">¶</a></h3>
<p>There many ways to get the one-electron integrals from pyscf.  Apparently, one
is to call <tt class="xref py py-func docutils literal"><span class="pre">getints_by_shell()</span></tt> like the previous example.  The other
method is to call <tt class="xref py py-func docutils literal"><span class="pre">got.getints()</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s">&#39;h 0 0 0; f 0 0 1&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s">&#39;sto-3g&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hcore</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">getints</span><span class="p">(</span><span class="s">&#39;cint1e_nuc_sph&#39;</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">atm</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">env</span><span class="p">)</span> <span class="o">+</span> <span class="n">gto</span><span class="o">.</span><span class="n">getints</span><span class="p">(</span><span class="s">&#39;cint1e_kin_sph&#39;</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">atm</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ovlp</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">getints</span><span class="p">(</span><span class="s">&#39;cint1e_ovlp_sph&#39;</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">atm</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
</pre></div>
</div>
<p>Actually, there is an even simpler function <tt class="xref py py-class docutils literal"><span class="pre">Mole.intor</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">hcore</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">intor</span><span class="p">(</span><span class="s">&#39;cint1e_nuc_sph&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">mol</span><span class="o">.</span><span class="n">intor</span><span class="p">(</span><span class="s">&#39;cint1e_kin_sph&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ovlp</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">intor</span><span class="p">(</span><span class="s">&#39;cint1e_ovlp_sph&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>There is a long list of supported AO integrals.  See <a class="reference internal" href="gto.html#gto-moleintor"><em>moleintor</em></a>.</p>
</div>
</div>
<div class="section" id="more-examples">
<h2>More examples<a class="headerlink" href="#more-examples" title="Permalink to this headline">¶</a></h2>
<p>Hartree-Fock with density fitting</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c">#</span>
<span class="c"># Author: Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c">#</span>

<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">scf</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Density fitting method by decorating the scf object with scf.density_fit function.</span>

<span class="sd">There is no flag to control the program to do density fitting for 2-electron</span>
<span class="sd">integration.  The way to call density fitting is to decorate the existed scf</span>
<span class="sd">object with scf.density_fit function.</span>

<span class="sd">NOTE scf.density_fit function generates a new object, which works exactly the</span>
<span class="sd">same way as the regular scf method.  The density fitting scf object is an</span>
<span class="sd">independent object to the regular scf object which is to be decorated.  By</span>
<span class="sd">doing so, density fitting can be applied anytime, anywhere in your script</span>
<span class="sd">without affecting the exsited scf object.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;8  0  0.     0</span>
<span class="s">              1  0  -0.757 0.587</span>
<span class="s">              1  0  0.757  0.587&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s">&#39;ccpvdz&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">density_fit</span><span class="p">(</span><span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">))</span>
<span class="n">energy</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;E = </span><span class="si">%.12f</span><span class="s">, ref = -76.0259362997&#39;</span> <span class="o">%</span> <span class="n">energy</span><span class="p">)</span>


<span class="n">mol</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mol</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">density_fit</span><span class="p">(</span><span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">))</span>
<span class="c"># the default auxiliary basis is Weigend Coulomb Fitting basis.</span>
<span class="n">mf</span><span class="o">.</span><span class="n">auxbasis</span> <span class="o">=</span> <span class="s">&#39;cc-pvdz-fit&#39;</span>
<span class="n">energy</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;E = </span><span class="si">%.12f</span><span class="s">, ref = -75.390940646297&#39;</span> <span class="o">%</span> <span class="n">energy</span><span class="p">)</span>
</pre></div>
</div>
<p>Use <tt class="xref py py-mod docutils literal"><span class="pre">scf.hf.SCF</span></tt> to simulate Hubbard model</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c">#</span>
<span class="c"># Author: Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c">#</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">scipy.linalg</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">scf</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">ao2mo</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">User-defined Hamiltonian for SCF module.</span>

<span class="sd">Three steps to define Hamiltonian for SCF:</span>
<span class="sd">1. Specify the number of electrons. (Note mole object must be &quot;built&quot; before doing this step)</span>
<span class="sd">2. Overwrite three attributes of scf object</span>
<span class="sd">    .get_hcore</span>
<span class="sd">    .get_ovlp</span>
<span class="sd">    ._eri</span>
<span class="sd">3. Specify initial guess (to overwrite the default atomic density initial guess)</span>

<span class="sd">Note you will see warning message on the screen:</span>

<span class="sd">        overwrite keys get_ovlp get_hcore of &lt;class &#39;pyscf.scf.hf.RHF&#39;&gt;</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">nelectron</span> <span class="o">=</span> <span class="mi">6</span>

<span class="c">#</span>
<span class="c"># 1D anti-PBC Hubbard model at half filling</span>
<span class="c">#</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">12</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">h1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">h1</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">h1</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="n">h1</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">h1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="n">eri</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">eri</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4.0</span>

<span class="n">mf</span><span class="o">.</span><span class="n">get_hcore</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">h1</span>
<span class="n">mf</span><span class="o">.</span><span class="n">get_ovlp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">mf</span><span class="o">.</span><span class="n">_eri</span> <span class="o">=</span> <span class="n">ao2mo</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">eri</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="n">mf</span><span class="o">.</span><span class="n">scf</span><span class="p">()</span>
</pre></div>
</div>
<p>Symmetry in CASSCF</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c">#</span>
<span class="c"># Author: Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c">#</span>

<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">mcscf</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Symmetry is not immutable</span>

<span class="sd">In PySCF, symmetry is not built-in data structure.  Orbitals are stored in C1</span>
<span class="sd">symmetry.  The irreps and symmetry information are generated on the fly.</span>
<span class="sd">We can switch on symmetry for CASSCF solver even the Hartree-Fock is not</span>
<span class="sd">optimized with symmetry.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&#39;O&#39;</span> <span class="p">,</span> <span class="p">(</span><span class="mf">0.</span> <span class="p">,</span> <span class="mf">0.</span>     <span class="p">,</span> <span class="mf">0.</span><span class="p">)],</span>
            <span class="p">[</span><span class="mi">1</span>   <span class="p">,</span> <span class="p">(</span><span class="mf">0.</span> <span class="p">,</span> <span class="o">-</span><span class="mf">0.757</span> <span class="p">,</span> <span class="mf">0.587</span><span class="p">)],</span>
            <span class="p">[</span><span class="mi">1</span>   <span class="p">,</span> <span class="p">(</span><span class="mf">0.</span> <span class="p">,</span> <span class="mf">0.757</span>  <span class="p">,</span> <span class="mf">0.587</span><span class="p">)]],</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s">&#39;cc-pvdz&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">symmetry</span> <span class="o">=</span> <span class="s">&#39;C2v&#39;</span><span class="p">)</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#quick-setup">Quick setup</a></li>
<li><a class="reference internal" href="#a-simple-example">A simple example</a></li>
<li><a class="reference internal" href="#input-molecule">Input molecule</a><ul>
<li><a class="reference internal" href="#geometry">Geometry</a></li>
<li><a class="reference internal" href="#basis-set">Basis set</a></li>
<li><a class="reference internal" href="#other-parameters">Other parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hf-mp2-mcscf">HF, MP2, MCSCF</a><ul>
<li><a class="reference internal" href="#hartree-fock">Hartree-Fock</a></li>
<li><a class="reference internal" href="#mp2-and-mo-integral-transformation">MP2 and MO integral transformation</a></li>
<li><a class="reference internal" href="#casci-and-casscf">CASCI and CASSCF</a></li>
</ul>
</li>
<li><a class="reference internal" href="#restore-previous-calculation">Restore previous calculation</a></li>
<li><a class="reference internal" href="#access-ao-integrals">Access AO integrals</a><ul>
<li><a class="reference internal" href="#libcint-interface">Libcint interface</a></li>
<li><a class="reference internal" href="#one-electron-ao-integrals">One electron AO integrals</a></li>
</ul>
</li>
<li><a class="reference internal" href="#more-examples">More examples</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="overview.html"
                        title="previous chapter">An overview of PySCF</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="advanced.html"
                        title="next chapter">Advanced topics</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="advanced.html" title="Advanced topics"
             >next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="An overview of PySCF"
             >previous</a> |</li>
        <li><a href="index.html">PySCF 1.3 alpha documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015-, Qiming Sun &lt;osirpt.sun@gmail.com&gt;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>