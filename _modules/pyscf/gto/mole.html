<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pyscf.gto.mole &mdash; PySCF 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="PySCF 1.0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PySCF 1.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pyscf.gto.mole</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8</span>
<span class="c">#</span>
<span class="c"># Author: Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c">#</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">gc</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">scipy.special</span>
<span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">import</span> <span class="nn">pyscf.lib.parameters</span> <span class="kn">as</span> <span class="nn">param</span>
<span class="kn">from</span> <span class="nn">pyscf.lib</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">pyscf.gto</span> <span class="kn">import</span> <span class="n">cmd_args</span>
<span class="kn">from</span> <span class="nn">pyscf.gto</span> <span class="kn">import</span> <span class="n">basis</span>
<span class="kn">from</span> <span class="nn">pyscf.gto</span> <span class="kn">import</span> <span class="n">moleintor</span>


<div class="viewcode-block" id="M"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.M">[docs]</a><span class="k">def</span> <span class="nf">M</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">r&#39;&#39;&#39;This is a simple way to build up Mole object quickly.</span>

<span class="sd">    Args: Same to :func:`Mole.build`</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; from pyscf import gto</span>
<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;H 0 0 0; F 0 0 1&#39;, basis=&#39;6-31g&#39;)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">Mole</span><span class="p">()</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">build_</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mol</span>
</div>
<span class="k">def</span> <span class="nf">_gaussian_int</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
    <span class="sd">r&#39;&#39;&#39;int_0^inf x^n exp(-alpha x^2) dx&#39;&#39;&#39;</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span>
    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">alpha</span><span class="o">**</span><span class="n">n1</span><span class="p">)</span>

<div class="viewcode-block" id="gto_norm"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.gto_norm">[docs]</a><span class="k">def</span> <span class="nf">gto_norm</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">expnt</span><span class="p">):</span>
    <span class="sd">r&#39;&#39;&#39;Normalized factor for GTO   :math:`g=r^l e^{-\alpha r^2}`</span>

<span class="sd">    .. math::</span>

<span class="sd">        \frac{1}{\sqrt{\int g^2 r^2 dr}}</span>
<span class="sd">        = \sqrt{\frac{2^{2l+3} (l+1)! (2a)^{l+1.5}}{(2l+2)!\sqrt{\pi}}}</span>

<span class="sd">    Ref: H. B. Schlegel and M. J. Frisch, Int. J. Quant.  Chem., 54(1955), 83-87.</span>

<span class="sd">    Args:</span>
<span class="sd">        l (int):</span>
<span class="sd">            angular momentum</span>
<span class="sd">        expnt :</span>
<span class="sd">            exponent :math:`\alpha`</span>

<span class="sd">    Returns:</span>
<span class="sd">        normalization factor</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; print gto_norm(0, 1)</span>
<span class="sd">    2.5264751109842591</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c">#f = 2**(2*l+3) * math.factorial(l+1) * (2*expnt)**(l+1.5) \</span>
        <span class="c">#        / (math.factorial(2*l+2) * math.sqrt(math.pi))</span>
        <span class="c">#return math.sqrt(f)</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">_gaussian_int</span><span class="p">(</span><span class="n">l</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">expnt</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;l should be &gt; 0&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="cart2sph"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.cart2sph">[docs]</a><span class="k">def</span> <span class="nf">cart2sph</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Cartesian to real spheric transformation matrix&#39;&#39;&#39;</span>
    <span class="n">nf</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
    <span class="n">cmat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cmat</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nd</span> <span class="o">=</span> <span class="n">l</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">c2sph</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">nd</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s">&#39;F&#39;</span><span class="p">)</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">_cint</span><span class="o">.</span><span class="n">CINTc2s_ket_sph</span>
        <span class="n">fn</span><span class="p">(</span><span class="n">c2sph</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">nf</span><span class="p">),</span>
           <span class="n">cmat</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">c2sph</span>
</div>
<div class="viewcode-block" id="cart2j_kappa"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.cart2j_kappa">[docs]</a><span class="k">def</span> <span class="nf">cart2j_kappa</span><span class="p">(</span><span class="n">kappa</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Cartesian to spinor, indexed by kappa&#39;&#39;&#39;</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">kappa</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kappa</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="o">-</span><span class="n">kappa</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">nd</span> <span class="o">=</span> <span class="n">l</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">kappa</span>
        <span class="n">nd</span> <span class="o">=</span> <span class="n">l</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">nf</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
    <span class="n">c2sph</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">nd</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s">&#39;F&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
    <span class="n">cmat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
    <span class="n">fn</span><span class="p">(</span><span class="n">c2sph</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">nf</span><span class="p">),</span>
       <span class="n">cmat</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">l</span><span class="p">),</span>
       <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">kappa</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">c2spinor</span>
</div>
<div class="viewcode-block" id="cart2j_l"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.cart2j_l">[docs]</a><span class="k">def</span> <span class="nf">cart2j_l</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Cartesian to spinor, indexed by l&#39;&#39;&#39;</span>
    <span class="n">nf</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
    <span class="n">nd</span> <span class="o">=</span> <span class="n">l</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="n">c2sph</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">nd</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s">&#39;F&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
    <span class="n">cmat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
    <span class="n">fn</span><span class="p">(</span><span class="n">c2sph</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">nf</span><span class="p">),</span>
       <span class="n">cmat</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">c2spinor</span>
</div>
<span class="k">def</span> <span class="nf">atom_types</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">atmgroup</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ia</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">atmgroup</span><span class="p">:</span>
            <span class="n">atmgroup</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">basis</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">atmgroup</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ia</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stdsymb</span> <span class="o">=</span> <span class="n">_std_symbol</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">basis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">stdsymb</span> <span class="ow">in</span> <span class="n">basis</span> <span class="ow">and</span> <span class="n">basis</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">basis</span><span class="p">[</span><span class="n">stdsymb</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">stdsymb</span> <span class="ow">in</span> <span class="n">atmgroup</span><span class="p">:</span>
                        <span class="n">atmgroup</span><span class="p">[</span><span class="n">stdsymb</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">atmgroup</span><span class="p">[</span><span class="n">stdsymb</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ia</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">atmgroup</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ia</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">stdsymb</span> <span class="ow">in</span> <span class="n">atmgroup</span><span class="p">:</span>
                <span class="n">atmgroup</span><span class="p">[</span><span class="n">stdsymb</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">atmgroup</span><span class="p">[</span><span class="n">stdsymb</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ia</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">atmgroup</span>


<div class="viewcode-block" id="format_atom"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.format_atom">[docs]</a><span class="k">def</span> <span class="nf">format_atom</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;Ang&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert the input :attr:`Mole.atom` to the internal data format.</span>
<span class="sd">    Including, changing the nuclear charge to atom symbol, rotate and shift</span>
<span class="sd">    molecule.  If the :attr:`~Mole.atom` is a string, it takes &quot;;&quot; and &quot;\\n&quot;</span>
<span class="sd">    for the mark to separate atoms;  &quot;,&quot; and arbitrary length of blank space</span>
<span class="sd">    to spearate the individual terms for an atom.  Blank line will be ignored.</span>

<span class="sd">    Args:</span>
<span class="sd">        atoms : list or str</span>
<span class="sd">            the same to :attr:`Mole.atom`</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        origin : ndarray</span>
<span class="sd">            new axis origin.</span>
<span class="sd">        axes : ndarray</span>
<span class="sd">            (new_x, new_y, new_z), each entry is a length-3 array</span>
<span class="sd">        unit : str</span>
<span class="sd">            set to Bohr/bohr to indicate the coordinates are in atomic unit</span>

<span class="sd">    Returns:</span>
<span class="sd">        formated :attr:`~Mole.atom`</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; gto.format_atom(&#39;9,0,0,0; h@1 0 0 1&#39;, origin=(1,1,1))</span>
<span class="sd">    [[&#39;F&#39;, [-1.0, -1.0, -1.0]], [&#39;H@1&#39;, [-1.0, -1.0, 0.0]]]</span>
<span class="sd">    &gt;&gt;&gt; gto.format_atom([&#39;9,0,0,0&#39;, (1, (0, 0, 1))], origin=(1,1,1))</span>
<span class="sd">    [[&#39;F&#39;, [-1.0, -1.0, -1.0]], [&#39;H&#39;, [-1, -1, 0]]]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s">&#39;B&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;au&#39;</span><span class="p">,</span><span class="s">&#39;AU&#39;</span><span class="p">)):</span>
        <span class="n">convert</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">BOHR</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">convert</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">fmt_atoms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">str2atm</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
        <span class="n">dat</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="n">symb</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ELEMENTS</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rawsymb</span> <span class="o">=</span> <span class="n">_rm_digit</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">symb</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">rawsymb</span><span class="p">,</span> <span class="n">_std_symbol</span><span class="p">(</span><span class="n">rawsymb</span><span class="p">))</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dat</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]])</span> <span class="o">-</span> <span class="n">origin</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">symb</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">c</span><span class="o">*</span><span class="n">convert</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">atoms</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">line1</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line1</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">):</span>
                <span class="n">fmt_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">str2atm</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">line1</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">line1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line1</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">):</span>
                    <span class="n">fmt_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">str2atm</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">symb</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ELEMENTS</span><span class="p">[</span><span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rawsymb</span> <span class="o">=</span> <span class="n">_rm_digit</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">symb</span> <span class="o">=</span> <span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">rawsymb</span><span class="p">,</span> <span class="n">_std_symbol</span><span class="p">(</span><span class="n">rawsymb</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span> <span class="o">-</span> <span class="n">origin</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">origin</span>
                <span class="n">fmt_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">symb</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">c</span><span class="o">*</span><span class="n">convert</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()])</span>
    <span class="k">return</span> <span class="n">fmt_atoms</span>

<span class="c">#TODO: sort exponents</span></div>
<div class="viewcode-block" id="format_basis"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.format_basis">[docs]</a><span class="k">def</span> <span class="nf">format_basis</span><span class="p">(</span><span class="n">basis_tab</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert the input :attr:`Mole.basis` to the internal data format.</span>

<span class="sd">    ``{ atom: (l, kappa, ((-exp, c_1, c_2, ..), nprim, nctr, ptr-exps, ptr-contraction-coeff)), ... }``</span>

<span class="sd">    Args:</span>
<span class="sd">        basis_tab : list</span>
<span class="sd">            Similar to :attr:`Mole.basis`, it **cannot** be a str</span>

<span class="sd">    Returns:</span>
<span class="sd">        Formated :attr:`~Mole.basis`</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; gto.format_basis({&#39;H&#39;:&#39;sto-3g&#39;, &#39;H^2&#39;: &#39;3-21g&#39;})</span>
<span class="sd">    {&#39;H&#39;: [[0,</span>
<span class="sd">        [3.4252509099999999, 0.15432897000000001],</span>
<span class="sd">        [0.62391373000000006, 0.53532813999999995],</span>
<span class="sd">        [0.16885539999999999, 0.44463454000000002]]],</span>
<span class="sd">     &#39;H^2&#39;: [[0,</span>
<span class="sd">        [5.4471780000000001, 0.15628500000000001],</span>
<span class="sd">        [0.82454700000000003, 0.90469100000000002]],</span>
<span class="sd">        [0, [0.18319199999999999, 1.0]]]}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">fmt_basis</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">basis_tab</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">symb</span> <span class="o">=</span> <span class="n">_symbol</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
        <span class="n">rawsymb</span> <span class="o">=</span> <span class="n">_rm_digit</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span>
        <span class="n">stdsymb</span> <span class="o">=</span> <span class="n">_std_symbol</span><span class="p">(</span><span class="n">rawsymb</span><span class="p">)</span>
        <span class="n">symb</span> <span class="o">=</span> <span class="n">symb</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">rawsymb</span><span class="p">,</span> <span class="n">stdsymb</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">basis_tab</span><span class="p">[</span><span class="n">atom</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">fmt_basis</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">basis_tab</span><span class="p">[</span><span class="n">atom</span><span class="p">],</span> <span class="n">stdsymb</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fmt_basis</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span> <span class="o">=</span> <span class="n">basis_tab</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">fmt_basis</span>

<span class="c"># transform etb to basis format</span></div>
<div class="viewcode-block" id="expand_etb"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.expand_etb">[docs]</a><span class="k">def</span> <span class="nf">expand_etb</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="sd">r&#39;&#39;&#39;Generate the exponents of even tempered basis for :attr:`Mole.basis`.</span>
<span class="sd">    .. math::</span>

<span class="sd">        e = e^{-\alpha * \beta^{i-1}} for i = 1 .. n</span>

<span class="sd">    Args:</span>
<span class="sd">        l : int</span>
<span class="sd">            Angular momentum</span>
<span class="sd">        n : int</span>
<span class="sd">            Number of GTOs</span>

<span class="sd">    Returns:</span>
<span class="sd">        Formated :attr:`~Mole.basis`</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; gto.expand_etb(1, 3, 1.5, 2)</span>
<span class="sd">    [[1, [6.0, 1]], [1, [3.0, 1]], [1, [1.5, 1]]]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">l</span><span class="p">,</span> <span class="p">[</span><span class="n">alpha</span><span class="o">*</span><span class="n">beta</span><span class="o">**</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))]</span></div>
<span class="k">def</span> <span class="nf">expand_etbs</span><span class="p">(</span><span class="n">etbs</span><span class="p">):</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="p">[</span><span class="n">expand_etb</span><span class="p">(</span><span class="o">*</span><span class="n">etb</span><span class="p">)</span> <span class="k">for</span> <span class="n">etb</span> <span class="ow">in</span> <span class="n">etbs</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">basis</span><span class="p">))</span>

<span class="c"># concatenate two mol</span>
<div class="viewcode-block" id="conc_env"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.conc_env">[docs]</a><span class="k">def</span> <span class="nf">conc_env</span><span class="p">(</span><span class="n">atm1</span><span class="p">,</span> <span class="n">bas1</span><span class="p">,</span> <span class="n">env1</span><span class="p">,</span> <span class="n">atm2</span><span class="p">,</span> <span class="n">bas2</span><span class="p">,</span> <span class="n">env2</span><span class="p">):</span>
    <span class="sd">r&#39;&#39;&#39;Concatenate two Mole&#39;s integral parameters.  This function can be used</span>
<span class="sd">    to construct the environment for cross integrals like</span>

<span class="sd">    .. math::</span>

<span class="sd">        \langle \mu | \nu \rangle, \mu \in mol1, \nu \in mol2</span>

<span class="sd">    Returns:</span>
<span class="sd">        Concatenated atm, bas, env</span>

<span class="sd">    Examples:</span>
<span class="sd">        Compute the overlap between H2 molecule and O atom</span>

<span class="sd">    &gt;&gt;&gt; mol1 = gto.M(atom=&#39;H 0 1 0; H 0 0 1&#39;, basis=&#39;sto3g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; mol2 = gto.M(atom=&#39;O 0 0 0&#39;, basis=&#39;sto3g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; atm3, bas3, env3 = gto.conc_env(mol1._atm, mol1._bas, mol1._env,</span>
<span class="sd">    ...                                 mol2._atm, mol2._bas, mol2._env)</span>
<span class="sd">    &gt;&gt;&gt; gto.moleintor.getints(&#39;cint1e_ovlp_sph&#39;, atm3, bas3, env3, range(2), range(2,5))</span>
<span class="sd">    [[ 0.04875181  0.44714688  0.          0.37820346  0.        ]</span>
<span class="sd">     [ 0.04875181  0.44714688  0.          0.          0.37820346]]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">off</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">env1</span><span class="p">)</span>
    <span class="n">natm_off</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">atm1</span><span class="p">)</span>
    <span class="n">atm2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">atm2</span><span class="p">)</span>
    <span class="n">bas2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">bas2</span><span class="p">)</span>
    <span class="n">atm2</span><span class="p">[:,</span><span class="n">PTR_COORD</span><span class="p">]</span> <span class="o">+=</span> <span class="n">off</span>
    <span class="n">atm2</span><span class="p">[:,</span><span class="n">PTR_MASS</span> <span class="p">]</span> <span class="o">+=</span> <span class="n">off</span>
    <span class="n">bas2</span><span class="p">[:,</span><span class="n">ATOM_OF</span>  <span class="p">]</span> <span class="o">+=</span> <span class="n">natm_off</span>
    <span class="n">bas2</span><span class="p">[:,</span><span class="n">PTR_EXP</span>  <span class="p">]</span> <span class="o">+=</span> <span class="n">off</span>
    <span class="n">bas2</span><span class="p">[:,</span><span class="n">PTR_COEFF</span><span class="p">]</span> <span class="o">+=</span> <span class="n">off</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">atm1</span><span class="p">,</span><span class="n">atm2</span><span class="p">)),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">bas1</span><span class="p">,</span><span class="n">bas2</span><span class="p">)),</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">env1</span><span class="p">,</span><span class="n">env2</span><span class="p">)))</span>

<span class="c"># &lt;bas-of-mol1|intor|bas-of-mol2&gt;</span></div>
<div class="viewcode-block" id="intor_cross"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.intor_cross">[docs]</a><span class="k">def</span> <span class="nf">intor_cross</span><span class="p">(</span><span class="n">intor</span><span class="p">,</span> <span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">r&#39;&#39;&#39;1-electron integrals from two molecules like</span>

<span class="sd">    .. math::</span>

<span class="sd">        \langle \mu | intor | \nu \rangle, \mu \in mol1, \nu \in mol2</span>

<span class="sd">    Args:</span>
<span class="sd">        intor : str</span>
<span class="sd">            Name of the 1-electron integral, such as cint1e_ovlp_sph (spherical overlap),</span>
<span class="sd">            cint1e_nuc_cart (cartesian nuclear attraction), cint1e_ipovlp</span>
<span class="sd">            (spinor overlap gradients), etc.  Ref to :func:`getints` for the</span>
<span class="sd">            full list of available 1-electron integral names</span>
<span class="sd">        mol1, mol2:</span>
<span class="sd">            :class:`Mole` objects</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        comp : int</span>
<span class="sd">            Components of the integrals, e.g. cint1e_ipovlp has 3 components</span>

<span class="sd">    Returns:</span>
<span class="sd">        ndarray of 1-electron integrals, can be either 2-dim or 3-dim, depending on comp</span>

<span class="sd">    Examples:</span>
<span class="sd">        Compute the overlap between H2 molecule and O atom</span>

<span class="sd">    &gt;&gt;&gt; mol1 = gto.M(atom=&#39;H 0 1 0; H 0 0 1&#39;, basis=&#39;sto3g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; mol2 = gto.M(atom=&#39;O 0 0 0&#39;, basis=&#39;sto3g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; gto.intor_cross(&#39;cint1e_ovlp_sph&#39;, mol1, mol2)</span>
<span class="sd">    [[ 0.04875181  0.44714688  0.          0.37820346  0.        ]</span>
<span class="sd">     [ 0.04875181  0.44714688  0.          0.          0.37820346]]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">nbas1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">_bas</span><span class="p">)</span>
    <span class="n">nbas2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol2</span><span class="o">.</span><span class="n">_bas</span><span class="p">)</span>
    <span class="n">atmc</span><span class="p">,</span> <span class="n">basc</span><span class="p">,</span> <span class="n">envc</span> <span class="o">=</span> <span class="n">conc_env</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="n">mol1</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="n">mol1</span><span class="o">.</span><span class="n">_env</span><span class="p">,</span> \
                                <span class="n">mol2</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="n">mol2</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="n">mol2</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>
    <span class="n">bras</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbas1</span><span class="p">)</span>
    <span class="n">kets</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbas1</span><span class="p">,</span> <span class="n">nbas1</span><span class="o">+</span><span class="n">nbas2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">getints</span><span class="p">(</span><span class="n">intor</span><span class="p">,</span> <span class="n">atmc</span><span class="p">,</span> <span class="n">basc</span><span class="p">,</span> <span class="n">envc</span><span class="p">,</span> <span class="n">bras</span><span class="p">,</span> <span class="n">kets</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c"># append (charge, pointer to coordinates, nuc_mod) to _atm</span></div>
<div class="viewcode-block" id="make_atm_env"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.make_atm_env">[docs]</a><span class="k">def</span> <span class="nf">make_atm_env</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert :attr:`Mole.atom` to the argument ``atm`` for ``libcint`` integrals</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_atm</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span>
    <span class="n">_env</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">/</span><span class="n">param</span><span class="o">.</span><span class="n">BOHR</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">_env</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">ELEMENTS</span><span class="p">[</span><span class="n">_atm</span><span class="p">[</span><span class="n">CHARGE_OF</span><span class="p">]][</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">_atm</span><span class="p">[</span><span class="n">CHARGE_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">_charge</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">_atm</span><span class="p">[</span><span class="n">PTR_COORD</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr</span>
    <span class="n">_atm</span><span class="p">[</span><span class="n">NUC_MOD_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">NUC_POINT</span>
    <span class="n">_atm</span><span class="p">[</span><span class="n">PTR_MASS</span> <span class="p">]</span> <span class="o">=</span> <span class="n">ptr</span> <span class="o">+</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_atm</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_env</span><span class="p">)</span>

<span class="c"># append (atom, l, nprim, nctr, kappa, ptr_exp, ptr_coeff, 0) to bas</span>
<span class="c"># absorb normalization into GTO contraction coefficients</span></div>
<div class="viewcode-block" id="make_bas_env"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.make_bas_env">[docs]</a><span class="k">def</span> <span class="nf">make_bas_env</span><span class="p">(</span><span class="n">basis_add</span><span class="p">,</span> <span class="n">atom_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Convert :attr:`Mole.basis` to the argument ``bas`` for ``libcint`` integrals</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_bas</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_env</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">basis_add</span><span class="p">:</span>
        <span class="n">angl</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">angl</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">angl</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;libcint may have large error for ERI of i function&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">kappa</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">b_coeff</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kappa</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">b_coeff</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">es</span> <span class="o">=</span> <span class="n">b_coeff</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="n">b_coeff</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">nprim</span><span class="p">,</span> <span class="n">nctr</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">gto_norm</span><span class="p">(</span><span class="n">angl</span><span class="p">,</span> <span class="n">es</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> \
                          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nprim</span><span class="p">)])</span>
<span class="c"># normalize contracted AO</span>
        <span class="n">ee</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nprim</span><span class="p">,</span><span class="n">nprim</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nprim</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">ee</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ee</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_gaussian_int</span><span class="p">(</span><span class="n">angl</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">es</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">es</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s">&#39;pi,pq,qi-&gt;i&#39;</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">ee</span><span class="p">,</span> <span class="n">cs</span><span class="p">))</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s">&#39;pi,i-&gt;pi&#39;</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span>

        <span class="n">_env</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">es</span><span class="p">)</span>
        <span class="n">_env</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">ptr_exp</span> <span class="o">=</span> <span class="n">ptr</span>
        <span class="n">ptr_coeff</span> <span class="o">=</span> <span class="n">ptr_exp</span> <span class="o">+</span> <span class="n">nprim</span>
        <span class="n">ptr</span> <span class="o">=</span> <span class="n">ptr_coeff</span> <span class="o">+</span> <span class="n">nprim</span> <span class="o">*</span> <span class="n">nctr</span>
        <span class="n">_bas</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">atom_id</span><span class="p">,</span> <span class="n">angl</span><span class="p">,</span> <span class="n">nprim</span><span class="p">,</span> <span class="n">nctr</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">ptr_exp</span><span class="p">,</span> <span class="n">ptr_coeff</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">_env</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">_env</span><span class="p">))</span> <span class="c"># flatten nested lists</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_bas</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_env</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="make_env"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.make_env">[docs]</a><span class="k">def</span> <span class="nf">make_env</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">pre_env</span><span class="o">=</span><span class="p">[],</span> <span class="n">nucmod</span><span class="o">=</span><span class="p">{},</span> <span class="n">mass</span><span class="o">=</span><span class="p">{}):</span>
    <span class="sd">&#39;&#39;&#39;Generate the input arguments for ``libcint`` library in terms of</span>
<span class="sd">    :attr:`Mole.atoms` and :attr:`Mole.basis`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_atm</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_bas</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_env</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ptr_env</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pre_env</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ia</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
        <span class="n">symb</span> <span class="o">=</span> <span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">atm0</span><span class="p">,</span> <span class="n">env0</span> <span class="o">=</span> <span class="n">make_atm_env</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">ptr_env</span><span class="p">)</span>
        <span class="n">ptr_env</span> <span class="o">=</span> <span class="n">ptr_env</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">env0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nucmod</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nucmod</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">assert</span><span class="p">(</span><span class="n">nucmod</span> <span class="ow">in</span> <span class="p">(</span><span class="n">NUC_POINT</span><span class="p">,</span> <span class="n">NUC_GAUSS</span><span class="p">))</span>
                <span class="n">atm0</span><span class="p">[</span><span class="n">NUC_MOD_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">nucmod</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nucmod</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">atm0</span><span class="p">[</span><span class="n">NUC_MOD_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">_parse_nuc_mod</span><span class="p">(</span><span class="n">nucmod</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ia</span><span class="o">+</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">nucmod</span><span class="p">:</span>
                <span class="n">atm0</span><span class="p">[</span><span class="n">NUC_MOD_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">_parse_nuc_mod</span><span class="p">(</span><span class="n">nucmod</span><span class="p">[</span><span class="n">ia</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">symb</span> <span class="ow">in</span> <span class="n">nucmod</span><span class="p">:</span>
                <span class="n">atm0</span><span class="p">[</span><span class="n">NUC_MOD_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">_parse_nuc_mod</span><span class="p">(</span><span class="n">nucmod</span><span class="p">[</span><span class="n">symb</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">_rm_digit</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span> <span class="ow">in</span> <span class="n">nucmod</span><span class="p">:</span>
                <span class="n">atm0</span><span class="p">[</span><span class="n">NUC_MOD_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">_parse_nuc_mod</span><span class="p">(</span><span class="n">nucmod</span><span class="p">[</span><span class="n">_rm_digit</span><span class="p">(</span><span class="n">symb</span><span class="p">)])</span>

        <span class="k">if</span> <span class="n">mass</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ia</span><span class="o">+</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">mass</span><span class="p">:</span>
                <span class="n">atm0</span><span class="p">[</span><span class="n">PTR_MASS</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr_env</span>
                <span class="n">env0</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">env0</span><span class="p">,</span> <span class="n">mass</span><span class="p">[</span><span class="n">ia</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">ptr_env</span> <span class="o">=</span> <span class="n">ptr_env</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">symb</span> <span class="ow">in</span> <span class="n">mass</span><span class="p">:</span>
                <span class="n">atm0</span><span class="p">[</span><span class="n">PTR_MASS</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr_env</span>
                <span class="n">env0</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">env0</span><span class="p">,</span> <span class="n">mass</span><span class="p">[</span><span class="n">symb</span><span class="p">]))</span>
                <span class="n">ptr_env</span> <span class="o">=</span> <span class="n">ptr_env</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">_rm_digit</span><span class="p">(</span><span class="n">symb</span><span class="p">)</span> <span class="ow">in</span> <span class="n">mass</span><span class="p">:</span>
                <span class="n">atm0</span><span class="p">[</span><span class="n">PTR_MASS</span><span class="p">]</span> <span class="o">=</span> <span class="n">ptr_env</span>
                <span class="n">env0</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">env0</span><span class="p">,</span> <span class="n">mass</span><span class="p">[</span><span class="n">_rm_digit</span><span class="p">(</span><span class="n">symb</span><span class="p">)]))</span>
                <span class="n">ptr_env</span> <span class="o">=</span> <span class="n">ptr_env</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">_atm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atm0</span><span class="p">)</span>
        <span class="n">_env</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env0</span><span class="p">)</span>

    <span class="n">_basdic</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">symb</span><span class="p">,</span> <span class="n">basis_add</span> <span class="ow">in</span> <span class="n">basis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">bas0</span><span class="p">,</span> <span class="n">env0</span> <span class="o">=</span> <span class="n">make_bas_env</span><span class="p">(</span><span class="n">basis_add</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ptr_env</span><span class="p">)</span>
        <span class="n">ptr_env</span> <span class="o">=</span> <span class="n">ptr_env</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">env0</span><span class="p">)</span>
        <span class="n">_basdic</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span> <span class="o">=</span> <span class="n">bas0</span>
        <span class="n">_env</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ia</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
        <span class="n">symb</span> <span class="o">=</span> <span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">symb</span> <span class="ow">in</span> <span class="n">_basdic</span><span class="p">:</span>
            <span class="n">bas0</span> <span class="o">=</span> <span class="n">_basdic</span><span class="p">[</span><span class="n">symb</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bas0</span> <span class="o">=</span> <span class="n">_basdic</span><span class="p">[</span><span class="n">_rm_digit</span><span class="p">(</span><span class="n">symb</span><span class="p">)]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">bas0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">b</span><span class="p">[:,</span><span class="n">ATOM_OF</span><span class="p">]</span> <span class="o">=</span> <span class="n">ia</span>
        <span class="n">_bas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_atm</span><span class="p">:</span>
        <span class="n">_atm</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">_atm</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ATM_SLOTS</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_atm</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="n">ATM_SLOTS</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_bas</span><span class="p">:</span>
        <span class="n">_bas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">_bas</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">BAS_SLOTS</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_bas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="n">BAS_SLOTS</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_env</span><span class="p">:</span>
        <span class="n">_env</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">pre_env</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">_env</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_env</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pre_env</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_atm</span><span class="p">,</span> <span class="n">_bas</span><span class="p">,</span> <span class="n">_env</span>
</div>
<div class="viewcode-block" id="tot_electrons"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.tot_electrons">[docs]</a><span class="k">def</span> <span class="nf">tot_electrons</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Total number of electrons for the given molecule</span>

<span class="sd">    Returns:</span>
<span class="sd">        electron number in integer</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;H 0 1 0; C 0 0 1&#39;, charge=1)</span>
<span class="sd">    &gt;&gt;&gt; gto.tot_electrons(mol)</span>
<span class="sd">    6</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">nelectron</span> <span class="o">=</span> <span class="o">-</span><span class="n">mol</span><span class="o">.</span><span class="n">charge</span>
    <span class="k">for</span> <span class="n">ia</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">natm</span><span class="p">):</span>
        <span class="n">nelectron</span> <span class="o">+=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_charge</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">nelectron</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="copy"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.copy">[docs]</a><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Deepcopy of the given :class:`Mole` object</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">copy</span>
    <span class="n">newmol</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">newmol</span><span class="o">.</span><span class="n">_atm</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_atm</span><span class="p">)</span>
    <span class="n">newmol</span><span class="o">.</span><span class="n">_bas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">)</span>
    <span class="n">newmol</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>
    <span class="n">newmol</span><span class="o">.</span><span class="n">atom</span>    <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span>
    <span class="n">newmol</span><span class="o">.</span><span class="n">basis</span>   <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>
    <span class="n">newmol</span><span class="o">.</span><span class="n">_basis</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_basis</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newmol</span>
</div>
<div class="viewcode-block" id="pack"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.pack">[docs]</a><span class="k">def</span> <span class="nf">pack</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Pack the given :class:`Mole` to a dict, which can be serialized with :mod:`pickle`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;atom&#39;</span>    <span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span>
            <span class="s">&#39;basis&#39;</span>   <span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">_basis</span><span class="p">,</span>
            <span class="s">&#39;charge&#39;</span>  <span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
            <span class="s">&#39;spin&#39;</span>    <span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">spin</span><span class="p">,</span>
            <span class="s">&#39;symmetry&#39;</span><span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">symmetry</span><span class="p">,</span>
            <span class="s">&#39;nucmod&#39;</span>  <span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">nucmod</span><span class="p">,</span>
            <span class="s">&#39;mass&#39;</span>    <span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">mass</span><span class="p">,</span>
            <span class="s">&#39;light_speed&#39;</span><span class="p">:</span> <span class="n">mol</span><span class="o">.</span><span class="n">light_speed</span><span class="p">}</span></div>
<div class="viewcode-block" id="unpack"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.unpack">[docs]</a><span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="n">moldic</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Unpack a dict which is packed by :func:`pack`, return a :class:`Mole` object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">Mole</span><span class="p">()</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">moldic</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mol</span>
</div>
<div class="viewcode-block" id="len_spinor"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.len_spinor">[docs]</a><span class="k">def</span> <span class="nf">len_spinor</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;The number of spinor associated with given angular momentum and kappa.  If kappa is 0,</span>
<span class="sd">    return 4l+2</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">kappa</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kappa</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span>
</div>
<div class="viewcode-block" id="len_cart"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.len_cart">[docs]</a><span class="k">def</span> <span class="nf">len_cart</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;The number of Cartesian function associated with given angular momentum.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</div>
<div class="viewcode-block" id="npgto_nr"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.npgto_nr">[docs]</a><span class="k">def</span> <span class="nf">npgto_nr</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Total number of primitive spherical GTOs for the given :class:`Mole` object&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">ANG_OF</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">NPRIM_OF</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span></div>
<div class="viewcode-block" id="nao_nr"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.nao_nr">[docs]</a><span class="k">def</span> <span class="nf">nao_nr</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Total number of contracted spherical GTOs for the given :class:`Mole` object&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">ANG_OF</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">NCTR_OF</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c"># nao_id0:nao_id1 corresponding to bas_id0:bas_id1</span></div>
<div class="viewcode-block" id="nao_nr_range"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.nao_nr_range">[docs]</a><span class="k">def</span> <span class="nf">nao_nr_range</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">bas_id0</span><span class="p">,</span> <span class="n">bas_id1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Lower and upper boundary of contracted spherical basis functions associated</span>
<span class="sd">    with the given shell range</span>

<span class="sd">    Args:</span>
<span class="sd">        mol :</span>
<span class="sd">            :class:`Mole` object</span>
<span class="sd">        bas_id0 : int</span>
<span class="sd">            start shell id</span>
<span class="sd">        bas_id1 : int</span>
<span class="sd">            stop shell id</span>

<span class="sd">    Returns:</span>
<span class="sd">        tupel of start basis function id and the stop function id</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;O 0 0 0; C 0 0 1&#39;, basis=&#39;6-31g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; gto.nao_nr_range(mol, 2, 4)</span>
<span class="sd">    (2, 6)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">nao_id0</span> <span class="o">=</span> <span class="p">((</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:</span><span class="n">bas_id0</span><span class="p">,</span><span class="n">ANG_OF</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:</span><span class="n">bas_id0</span><span class="p">,</span><span class="n">NCTR_OF</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="p">((</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id0</span><span class="p">:</span><span class="n">bas_id1</span><span class="p">,</span><span class="n">ANG_OF</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id0</span><span class="p">:</span><span class="n">bas_id1</span><span class="p">,</span><span class="n">NCTR_OF</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">nao_id0</span><span class="p">,</span> <span class="n">nao_id0</span><span class="o">+</span><span class="n">n</span>
</div>
<div class="viewcode-block" id="nao_2c"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.nao_2c">[docs]</a><span class="k">def</span> <span class="nf">nao_2c</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Total number of contracted spinor GTOs for the given :class:`Mole` object&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">mol</span><span class="o">.</span><span class="n">bas_len_spinor</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_nctr</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> \
                <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">))])</span>

<span class="c"># nao_id0:nao_id1 corresponding to bas_id0:bas_id1</span></div>
<div class="viewcode-block" id="nao_2c_range"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.nao_2c_range">[docs]</a><span class="k">def</span> <span class="nf">nao_2c_range</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">bas_id0</span><span class="p">,</span> <span class="n">bas_id1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Lower and upper boundary of contracted spinor basis functions associated</span>
<span class="sd">    with the given shell range</span>

<span class="sd">    Args:</span>
<span class="sd">        mol :</span>
<span class="sd">            :class:`Mole` object</span>
<span class="sd">        bas_id0 : int</span>
<span class="sd">            start shell id, 0-based</span>
<span class="sd">        bas_id1 : int</span>
<span class="sd">            stop shell id, 0-based</span>

<span class="sd">    Returns:</span>
<span class="sd">        tupel of start basis function id and the stop function id</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;O 0 0 0; C 0 0 1&#39;, basis=&#39;6-31g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; gto.nao_2c_range(mol, 2, 4)</span>
<span class="sd">    (4, 12)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">nao_id0</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">mol</span><span class="o">.</span><span class="n">bas_len_spinor</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_nctr</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> \
                   <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bas_id0</span><span class="p">)])</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">mol</span><span class="o">.</span><span class="n">bas_len_spinor</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_nctr</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> \
             <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bas_id0</span><span class="p">,</span> <span class="n">bas_id1</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">nao_id0</span><span class="p">,</span> <span class="n">nao_id0</span><span class="o">+</span><span class="n">n</span>
</div>
<div class="viewcode-block" id="ao_loc_nr"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.ao_loc_nr">[docs]</a><span class="k">def</span> <span class="nf">ao_loc_nr</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Offset of every shell in the spherical basis function spectrum</span>

<span class="sd">    Returns:</span>
<span class="sd">        list, each entry is the corresponding start basis function id</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;O 0 0 0; C 0 0 1&#39;, basis=&#39;6-31g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; gto.ao_loc_nr(mol)</span>
<span class="sd">    [0, 1, 2, 3, 6, 9, 10, 11, 12, 15, 18]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">off</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ao_loc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">)):</span>
        <span class="n">ao_loc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">off</span><span class="p">)</span>
        <span class="n">off</span> <span class="o">+=</span> <span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">bas_angular</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_nctr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">ao_loc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">off</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ao_loc</span>
</div>
<div class="viewcode-block" id="ao_loc_2c"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.ao_loc_2c">[docs]</a><span class="k">def</span> <span class="nf">ao_loc_2c</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Offset of every shell in the spinor basis function spectrum</span>

<span class="sd">    Returns:</span>
<span class="sd">        list, each entry is the corresponding start id of spinor function</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;O 0 0 0; C 0 0 1&#39;, basis=&#39;6-31g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; gto.ao_loc_2c(mol)</span>
<span class="sd">    [0, 2, 4, 6, 12, 18, 20, 22, 24, 30, 36]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">off</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ao_loc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">)):</span>
        <span class="n">ao_loc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">off</span><span class="p">)</span>
        <span class="n">off</span> <span class="o">+=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_len_spinor</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_nctr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">ao_loc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">off</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ao_loc</span>
</div>
<div class="viewcode-block" id="time_reversal_map"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.time_reversal_map">[docs]</a><span class="k">def</span> <span class="nf">time_reversal_map</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
    <span class="sd">r&#39;&#39;&#39;The index to map the spinor functions and its time reversal counterpart.</span>
<span class="sd">    The returned indices have postive and negative value.  For the i-th basis function,</span>
<span class="sd">    if the returned j = idx[i] &lt; 0, it means :math:`T|i\rangle = -|j\rangle`,</span>
<span class="sd">    otherwise :math:`T|i\rangle = |j\rangle`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">tao</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">ANG_OF</span><span class="p">];</span>
        <span class="k">if</span> <span class="n">b</span><span class="p">[</span><span class="n">KAPPA_OF</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">djs</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="n">KAPPA_OF</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">djs</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">djs</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,)</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">NCTR_OF</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">dj</span> <span class="ow">in</span> <span class="n">djs</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dj</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                        <span class="n">tao</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">dj</span> <span class="o">-</span> <span class="n">m</span><span class="p">))</span>
                        <span class="n">tao</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="n">i</span> <span class="o">+</span> <span class="n">dj</span> <span class="o">-</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="n">dj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">NCTR_OF</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">dj</span> <span class="ow">in</span> <span class="n">djs</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dj</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                        <span class="n">tao</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="n">i</span> <span class="o">+</span> <span class="n">dj</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span>
                        <span class="n">tao</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">dj</span> <span class="o">-</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="n">dj</span>
    <span class="k">return</span> <span class="n">tao</span>
</div>
<div class="viewcode-block" id="energy_nuc"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.energy_nuc">[docs]</a><span class="k">def</span> <span class="nf">energy_nuc</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Nuclear repulsion energy, (AU)</span>

<span class="sd">    Returns</span>
<span class="sd">        float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">natm</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="c">#e = 0</span>
    <span class="c">#chargs = [mol.atom_charge(i) for i in range(len(mol._atm))]</span>
    <span class="c">#coords = [mol.atom_coord(i) for i in range(len(mol._atm))]</span>
    <span class="c">#for j in range(len(mol._atm)):</span>
    <span class="c">#    q2 = chargs[j]</span>
    <span class="c">#    r2 = coords[j]</span>
    <span class="c">#    for i in range(j):</span>
    <span class="c">#        q1 = chargs[i]</span>
    <span class="c">#        r1 = coords[i]</span>
    <span class="c">#        r = numpy.linalg.norm(r1-r2)</span>
    <span class="c">#        e += q1 * q2 / r</span>
    <span class="n">chargs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mol</span><span class="o">.</span><span class="n">atom_charge</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_atm</span><span class="p">))])</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mol</span><span class="o">.</span><span class="n">atom_coord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_atm</span><span class="p">))])</span>
    <span class="n">rr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">coords</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">rd</span> <span class="o">=</span> <span class="n">rr</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span>
    <span class="n">rr</span> <span class="o">=</span> <span class="n">rd</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">-</span> <span class="n">rr</span><span class="o">*</span><span class="mi">2</span>
    <span class="n">rr</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">diag_indices_from</span><span class="p">(</span><span class="n">rr</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1e-60</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>
    <span class="n">qq</span> <span class="o">=</span> <span class="n">chargs</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">chargs</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span>
    <span class="n">qq</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">diag_indices_from</span><span class="p">(</span><span class="n">qq</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="n">qq</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span>
    <span class="k">return</span> <span class="n">e</span>
</div>
<div class="viewcode-block" id="spheric_labels"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.spheric_labels">[docs]</a><span class="k">def</span> <span class="nf">spheric_labels</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Labels for spheric GTO functions</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        fmt : str or bool</span>
<span class="sd">        if fmt is boolean, it controls whether to format the labels and the</span>
<span class="sd">        default format is &quot;%d%3s %s%-4s&quot;.  if fmt is string, the string will</span>
<span class="sd">        be used as the print format.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of [(atom-id, symbol-str, nl-str, str-of-real-spheric-notation]</span>
<span class="sd">        or formatted strings based on the argument &quot;fmt&quot;</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;H 0 0 0; Cl 0 0 1&#39;, basis=&#39;sto-3g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; gto.spheric_labels(mol)</span>
<span class="sd">    [(0, &#39;H&#39;, &#39;1s&#39;, &#39;&#39;), (1, &#39;Cl&#39;, &#39;1s&#39;, &#39;&#39;), (1, &#39;Cl&#39;, &#39;2s&#39;, &#39;&#39;), (1, &#39;Cl&#39;, &#39;3s&#39;, &#39;&#39;), (1, &#39;Cl&#39;, &#39;2p&#39;, &#39;x&#39;), (1, &#39;Cl&#39;, &#39;2p&#39;, &#39;y&#39;), (1, &#39;Cl&#39;, &#39;2p&#39;, &#39;z&#39;), (1, &#39;Cl&#39;, &#39;3p&#39;, &#39;x&#39;), (1, &#39;Cl&#39;, &#39;3p&#39;, &#39;y&#39;), (1, &#39;Cl&#39;, &#39;3p&#39;, &#39;z&#39;)]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">mol</span><span class="o">.</span><span class="n">natm</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">)):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_atom</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_angular</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">strl</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ANGULAR</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_nctr</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">symb</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_symbol</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">nc</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ia</span><span class="p">,</span> <span class="n">symb</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%d%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">strl</span><span class="p">),</span> \
                              <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">param</span><span class="o">.</span><span class="n">REAL_SPHERIC</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="n">l</span><span class="o">+</span><span class="n">m</span><span class="p">]))</span>
        <span class="n">count</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nc</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">label</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">fmt</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s%-4s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">label</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">label</span>
</div>
<div class="viewcode-block" id="cart_labels"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.cart_labels">[docs]</a><span class="k">def</span> <span class="nf">cart_labels</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Labels for Cartesian GTO functions</span>

<span class="sd">    Kwargs:</span>
<span class="sd">        fmt : str or bool</span>
<span class="sd">        if fmt is boolean, it controls whether to format the labels and the</span>
<span class="sd">        default format is &quot;%d%3s %s%-4s&quot;.  if fmt is string, the string will</span>
<span class="sd">        be used as the print format.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of [(atom-id, symbol-str, nl-str, str-of-real-spheric-notation]</span>
<span class="sd">        or formatted strings based on the argument &quot;fmt&quot;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">mol</span><span class="o">.</span><span class="n">natm</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">)):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_atom</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_angular</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">strl</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ANGULAR</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_nctr</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">symb</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_symbol</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">nc</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">lx</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">ly</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="n">lx</span><span class="p">)):</span>
                    <span class="n">lz</span> <span class="o">=</span> <span class="n">l</span> <span class="o">-</span> <span class="n">lx</span> <span class="o">-</span> <span class="n">ly</span>
                    <span class="n">label</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ia</span><span class="p">,</span> <span class="n">symb</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%d%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">strl</span><span class="p">),</span>
                                  <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s">&#39;x&#39;</span><span class="o">*</span><span class="n">lx</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="o">*</span><span class="n">ly</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="o">*</span><span class="n">lz</span><span class="p">))))</span>
        <span class="n">count</span><span class="p">[</span><span class="n">ia</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="n">nc</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">label</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">fmt</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%d%3s</span><span class="s"> </span><span class="si">%s%-4s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">label</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">label</span>

</div>
<span class="k">def</span> <span class="nf">spinor_labels</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;TODO&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="search_shell_id"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.search_shell_id">[docs]</a><span class="k">def</span> <span class="nf">search_shell_id</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Search the first basis/shell id (**not** the basis function id) which</span>
<span class="sd">    matches the given atom-id and angular momentum</span>

<span class="sd">    Args:</span>
<span class="sd">        atm_id : int</span>
<span class="sd">            atom id, 0-based</span>
<span class="sd">        l : int</span>
<span class="sd">            angular momentum</span>

<span class="sd">    Returns:</span>
<span class="sd">        basis id, 0-based.  If not found, return None</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;H 0 0 0; Cl 0 0 1&#39;, basis=&#39;sto-3g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; mol.search_shell_id(1, 1) # Cl p shell</span>
<span class="sd">    4</span>
<span class="sd">    &gt;&gt;&gt; mol.search_shell_id(1, 2) # Cl d shell</span>
<span class="sd">    None</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">)):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_atom</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">l1</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_angular</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ia</span> <span class="o">==</span> <span class="n">atm_id</span> <span class="ow">and</span> <span class="n">l1</span> <span class="o">==</span> <span class="n">l</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ib</span>
</div>
<div class="viewcode-block" id="search_ao_nr"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.search_ao_nr">[docs]</a><span class="k">def</span> <span class="nf">search_ao_nr</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">atmshell</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Search the first basis function id (**not** the shell id) which matches</span>
<span class="sd">    the given atom-id, angular momentum magnetic angular momentum, principal shell.</span>

<span class="sd">    Args:</span>
<span class="sd">        atm_id : int</span>
<span class="sd">            atom id, 0-based</span>
<span class="sd">        l : int</span>
<span class="sd">            angular momentum</span>
<span class="sd">        m : int</span>
<span class="sd">            magnetic angular momentum</span>
<span class="sd">        atmshell : int</span>
<span class="sd">            principal quantum number</span>

<span class="sd">    Returns:</span>
<span class="sd">        basis function id, 0-based.  If not found, return None</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = gto.M(atom=&#39;H 0 0 0; Cl 0 0 1&#39;, basis=&#39;sto-3g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; mol.search_ao_nr(1, 1, -1, 3) # Cl 3px</span>
<span class="sd">    7</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ibf</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_bas</span><span class="p">)):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_atom</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">l1</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_angular</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">bas_nctr</span><span class="p">(</span><span class="n">ib</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ia</span> <span class="o">==</span> <span class="n">atm_id</span> <span class="ow">and</span> <span class="n">l1</span> <span class="o">==</span> <span class="n">l</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">atmshell</span> <span class="o">&gt;</span> <span class="n">nc</span><span class="o">+</span><span class="n">l1</span><span class="p">:</span>
                <span class="n">atmshell</span> <span class="o">=</span> <span class="n">atmshell</span> <span class="o">-</span> <span class="n">nc</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ibf</span> <span class="o">+</span> <span class="p">(</span><span class="n">atmshell</span><span class="o">-</span><span class="n">l1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">l1</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">l1</span><span class="o">+</span><span class="n">m</span><span class="p">)</span>
        <span class="n">ibf</span> <span class="o">+=</span> <span class="p">(</span><span class="n">l1</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nc</span>
</div>
<span class="k">def</span> <span class="nf">search_ao_r</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">atmshell</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;TODO&#39;</span><span class="p">)</span>
<span class="c">#TODO:    ibf = 0</span>
<span class="c">#TODO:    for ib in range(len(mol._bas)):</span>
<span class="c">#TODO:        ia = mol.bas_atom(ib)</span>
<span class="c">#TODO:        l1 = mol.bas_angular(ib)</span>
<span class="c">#TODO:        nc = mol.bas_nctr(ib)</span>
<span class="c">#TODO:        k = mol.bas_kappa(bas_id)</span>
<span class="c">#TODO:        degen = len_spinor(l1, k)</span>
<span class="c">#TODO:        if ia == atm_id and l1 == l and k == kappa:</span>
<span class="c">#TODO:            if atmshell &gt; nc+l1:</span>
<span class="c">#TODO:                atmshell = atmshell - nc</span>
<span class="c">#TODO:            else:</span>
<span class="c">#TODO:                return ibf + (atmshell-l1-1)*degen + (degen+m)</span>
<span class="c">#TODO:        ibf += degen</span>

<span class="k">def</span> <span class="nf">is_same_mol</span><span class="p">(</span><span class="n">mol1</span><span class="p">,</span> <span class="n">mol2</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">mol1</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">__len__</span><span class="p">()</span> <span class="o">!=</span> <span class="n">mol2</span><span class="o">.</span><span class="n">atom</span><span class="o">.</span><span class="n">__len__</span><span class="p">():</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mol1</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">mol2</span><span class="o">.</span><span class="n">atom</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">a2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> \
           <span class="ow">or</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>


<div class="viewcode-block" id="check_sanity"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.check_sanity">[docs]</a><span class="k">def</span> <span class="nf">check_sanity</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">keysref</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Check misinput of class attributes, check whether a class method is</span>
<span class="sd">    overwritten.  It does not check the attributes which are prefixed with</span>
<span class="sd">    &quot;_&quot;.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj : this object should have attribute _keys to store all the</span>
<span class="sd">        name of the attributes of the object</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">objkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;_&#39;</span><span class="p">]</span>
    <span class="n">keysub</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">objkeys</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">keysref</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">keysub</span><span class="p">:</span>
        <span class="n">keyin</span> <span class="o">=</span> <span class="n">keysub</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">keyin</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;overwrite keys </span><span class="si">%s</span><span class="s"> of </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span>
                   <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keyin</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="p">)))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">keydiff</span> <span class="o">=</span> <span class="n">keysub</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">keydiff</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> has no attributes </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span>
                   <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="p">),</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keydiff</span><span class="p">)))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>


<span class="c"># for _atm, _bas, _env</span></div>
<span class="n">CHARGE_OF</span>  <span class="o">=</span> <span class="mi">0</span>
<span class="n">PTR_COORD</span>  <span class="o">=</span> <span class="mi">1</span>
<span class="n">NUC_MOD_OF</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">PTR_MASS</span>   <span class="o">=</span> <span class="mi">3</span>
<span class="n">RAD_GRIDS</span>  <span class="o">=</span> <span class="mi">4</span>
<span class="n">ANG_GRIDS</span>  <span class="o">=</span> <span class="mi">5</span>
<span class="n">ATM_SLOTS</span>  <span class="o">=</span> <span class="mi">6</span>
<span class="n">ATOM_OF</span>    <span class="o">=</span> <span class="mi">0</span>
<span class="n">ANG_OF</span>     <span class="o">=</span> <span class="mi">1</span>
<span class="n">NPRIM_OF</span>   <span class="o">=</span> <span class="mi">2</span>
<span class="n">NCTR_OF</span>    <span class="o">=</span> <span class="mi">3</span>
<span class="n">KAPPA_OF</span>   <span class="o">=</span> <span class="mi">4</span>
<span class="n">PTR_EXP</span>    <span class="o">=</span> <span class="mi">5</span>
<span class="n">PTR_COEFF</span>  <span class="o">=</span> <span class="mi">6</span>
<span class="n">BAS_SLOTS</span>  <span class="o">=</span> <span class="mi">8</span>
<span class="c"># pointer to env</span>
<span class="n">PTR_LIGHT_SPEED</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">PTR_COMMON_ORIG</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">PTR_RINV_ORIG</span>   <span class="o">=</span> <span class="mi">4</span>
<span class="n">PTR_ENV_START</span>   <span class="o">=</span> <span class="mi">20</span>
<span class="c"># parameters from libcint</span>
<span class="n">NUC_POINT</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">NUC_GAUSS</span> <span class="o">=</span> <span class="mi">2</span>


<div class="viewcode-block" id="Mole"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole">[docs]</a><span class="k">class</span> <span class="nc">Mole</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Basic class to hold molecular structure and global options</span>

<span class="sd">    Attributes:</span>
<span class="sd">        verbose : int</span>
<span class="sd">            Print level</span>
<span class="sd">        output : str or None</span>
<span class="sd">            Output file, default is None which dumps msg to sys.stdout</span>
<span class="sd">        max_memory : int, float</span>
<span class="sd">            Allowed memory in MB</span>
<span class="sd">        light_speed :</span>
<span class="sd">            Default is set in lib.parameters.LIGHTSPEED</span>
<span class="sd">        charge : int</span>
<span class="sd">            Charge of molecule. It affects the electron numbers</span>
<span class="sd">        spin : int</span>
<span class="sd">            2S, num. alpha electrons - num. beta electrons</span>
<span class="sd">        symmetry : bool or str</span>
<span class="sd">            Whether to use symmetry.  When this variable is set to True, the</span>
<span class="sd">            molecule will be rotated and the highest rotation axis will be</span>
<span class="sd">            placed z-axis.</span>
<span class="sd">            If a string is given as the name of point group, the given point</span>
<span class="sd">            group symmetry will be used.  Note that the input molecular</span>
<span class="sd">            coordinates will not be changed in this case.</span>
<span class="sd">        symmetry_subgroup : str</span>
<span class="sd">            subgroup</span>

<span class="sd">        atom : list or str</span>
<span class="sd">            To define molecluar structure.  The internal format is</span>

<span class="sd">            | atom = [[atom1, (x, y, z)],</span>
<span class="sd">            |         [atom2, (x, y, z)],</span>
<span class="sd">            |         ...</span>
<span class="sd">            |         [atomN, (x, y, z)]]</span>

<span class="sd">        basis : dict or str</span>
<span class="sd">            To define basis set.</span>
<span class="sd">        nucmod : dict or str</span>
<span class="sd">            Nuclear model</span>
<span class="sd">        mass : dict</span>
<span class="sd">            Similar struct as :attr:`Mole.nucmod`</span>

<span class="sd">        ** Following attributes are generated by :func:`Mole.build` **</span>

<span class="sd">        stdout : file object</span>
<span class="sd">            Default is sys.stdout if :attr:`Mole.output` is not set</span>
<span class="sd">        groupname : str</span>
<span class="sd">            One of D2h, C2h, C2v, D2, Cs, Ci, C2, C1</span>
<span class="sd">        nelectron : int</span>
<span class="sd">            sum of nuclear charges - :attr:`Mole.charge`</span>
<span class="sd">        symm_orb : a list of numpy.ndarray</span>
<span class="sd">            Symmetry adapted basis.  Each element is a set of symm-adapted orbitals</span>
<span class="sd">            for one irreducible representation.  The list index does **not** correspond</span>
<span class="sd">            to the id of irreducible representation.</span>
<span class="sd">        irrep_id : a list of int</span>
<span class="sd">            Each element is one irreducible representation id associated with the basis</span>
<span class="sd">            stored in symm_orb.  One irrep id stands for one irreducible representation</span>
<span class="sd">            symbol.  The irrep symbol and the relevant id are defined in</span>
<span class="sd">            :attr:`symm.parameters.IRREP_ID_TABLE`</span>
<span class="sd">        irrep_name : a list of str</span>
<span class="sd">            Each element is one irreducible representation symbol associated with the basis</span>
<span class="sd">            stored in symm_orb.  The irrep symbols are defined in</span>
<span class="sd">            :attr:`symm.parameters.IRREP_ID_TABLE`</span>
<span class="sd">        _built : bool</span>
<span class="sd">            To label whether :func:`Mole.build` has been called.  It ensures some functions</span>
<span class="sd">            being initialized once.</span>
<span class="sd">        _basis : dict</span>
<span class="sd">            like :attr:`Mole.basis`, the internal format which is returned from the</span>
<span class="sd">            parser :func:`format_basis`</span>
<span class="sd">        _keys : a set of str</span>
<span class="sd">            Store the keys appeared in the module.  It is used to check misinput attributes</span>

<span class="sd">        ** Following attributes are arguments used by ``libcint`` library **</span>

<span class="sd">        _atm :</span>
<span class="sd">            :code:`[[charge, ptr-of-coord, nuc-model, mass, 0, 0], [...]]`</span>
<span class="sd">            each element reperesents one atom</span>
<span class="sd">        natm :</span>
<span class="sd">            number of atoms</span>
<span class="sd">        _bas :</span>
<span class="sd">            :code:`[[atom-id, angular-momentum, num-primitive-GTO, num-contracted-GTO, 0, ptr-of-exps, ptr-of-contract-coeff, 0], [...]]`</span>
<span class="sd">            each element reperesents one shell</span>
<span class="sd">        nbas :</span>
<span class="sd">            number of shells</span>
<span class="sd">        _env :</span>
<span class="sd">            list of floats to store the coordinates, GTO exponents, contract-coefficients</span>

<span class="sd">    Examples:</span>

<span class="sd">    &gt;&gt;&gt; mol = Mole(atom=&#39;H^2 0 0 0; H 0 0 1.1&#39;, basis=&#39;sto3g&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(mol.atom_symbol(0))</span>
<span class="sd">    H^2</span>
<span class="sd">    &gt;&gt;&gt; print(mol.atom_pure_symbol(0))</span>
<span class="sd">    H</span>
<span class="sd">    &gt;&gt;&gt; print(mol.nao_nr())</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; print(mol.intor(&#39;cint1e_ovlp_sph&#39;))</span>
<span class="sd">    [[ 0.99999999  0.43958641]</span>
<span class="sd">     [ 0.43958641  0.99999999]]</span>
<span class="sd">    &gt;&gt;&gt; mol.charge = 1</span>
<span class="sd">    &gt;&gt;&gt; mol.build()</span>
<span class="sd">    &lt;class &#39;pyscf.gto.mole.Mole&#39;&gt; has no attributes Charge</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">NOTE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_memory</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">MEMORY_MAX</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">light_speed</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">LIGHTSPEED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># 2j == nelec_alpha - nelec_beta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_subgroup</span> <span class="o">=</span> <span class="bp">None</span>

<span class="c"># atom, etb, basis, nucmod, mass to save inputs</span>
<span class="c"># self.atom = [(symb/nuc_charge, (coord(Angstrom):0.,0.,0.)), ...]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c"># self.basis = {atom_type/nuc_charge: [l, kappa, (expnt, c_1, c_2,..),..]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s">&#39;sto-3g&#39;</span>
<span class="c"># self.nucmod = {atom_symbol: nuclear_model, atom_id: nuc_mod}, atom_id is 1-based</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nucmod</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c"># self.mass = {atom_symbol: mass, atom_id: mass}, atom_id is 1-based</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c">##################################################</span>
<span class="c"># don&#39;t modify the following private variables, they are not input options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">natm</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbas</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">PTR_ENV_START</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groupname</span> <span class="o">=</span> <span class="s">&#39;C1&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span> <span class="o">=</span> <span class="s">&#39;C1&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nelectron</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symm_orb</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irrep_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irrep_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incore_anyway</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_basis</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_built</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="Mole.check_sanity"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.check_sanity">[docs]</a>    <span class="k">def</span> <span class="nf">check_sanity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Check misinput of class attributes, check whether a class method is</span>
<span class="sd">        overwritten.  It does not check the attributes which are prefixed with</span>
<span class="sd">        &quot;_&quot;.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj : this object should have attribute _keys to store all the</span>
<span class="sd">            name of the attributes of the object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;_keys&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="n">logger</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
                <span class="n">check_sanity</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_keys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

<span class="c"># need &quot;deepcopy&quot; here because in shallow copy, _env may get new elements but</span>
<span class="c"># with ptr_env unchanged</span>
<span class="c"># def __copy__(self):</span>
<span class="c">#        cls = self.__class__</span>
<span class="c">#        newmol = cls.__new__(cls)</span>
<span class="c">#        newmol = ...</span>
<span class="c"># do not use __copy__ to aovid iteratively call copy.copy</span></div>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">moldic</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">unpack</span><span class="p">(</span><span class="n">moldic</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unpack_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">moldic</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">moldic</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<div class="viewcode-block" id="Mole.build_"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.build_">[docs]</a>    <span class="k">def</span> <span class="nf">build_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dump_input</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">parse_arg</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
               <span class="n">verbose</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_memory</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">atom</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nucmod</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">charge</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">symmetry</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">symmetry_subgroup</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">light_speed</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Setup moleclue and initialize some control parameters.  Whenever you</span>
<span class="sd">        change the value of the attributes of :class:`Mole`, you need call</span>
<span class="sd">        this function to refresh the internal data of Mole.</span>

<span class="sd">        Kwargs:</span>
<span class="sd">            dump_input : bool</span>
<span class="sd">                whether to dump the contents of input file in the output file</span>
<span class="sd">            parse_arg : bool</span>
<span class="sd">                whether to read the sys.argv and overwrite the relevant parameters</span>
<span class="sd">            verbose : int</span>
<span class="sd">                Print level.  If given, overwrite :attr:`Mole.verbose`</span>
<span class="sd">            output : str or None</span>
<span class="sd">                Output file.  If given, overwrite :attr:`Mole.output`</span>
<span class="sd">            max_memory : int, float</span>
<span class="sd">                Allowd memory in MB.  If given, overwrite :attr:`Mole.max_memory`</span>
<span class="sd">            atom : list or str</span>
<span class="sd">                To define molecluar structure.  If given, overwrite :attr:`Mole.atom`</span>
<span class="sd">            basis : dict or str</span>
<span class="sd">                To define basis set.  If given, overwrite :attr:`Mole.basis`</span>
<span class="sd">            nucmod : dict or str</span>
<span class="sd">                Nuclear model.  If given, overwrite :attr:`Mole.nucmod`</span>
<span class="sd">            mass : dict</span>
<span class="sd">                If given, overwrite :attr:`Mole.mass`</span>
<span class="sd">            charge : int</span>
<span class="sd">                Charge of molecule. It affects the electron numbers</span>
<span class="sd">                If given, overwrite :attr:`Mole.charge`</span>
<span class="sd">            spin : int</span>
<span class="sd">                2S, num. alpha electrons - num. beta electrons</span>
<span class="sd">                If given, overwrite :attr:`Mole.spin`</span>
<span class="sd">            symmetry : bool or str</span>
<span class="sd">                Whether to use symmetry.  If given a string of point group</span>
<span class="sd">                name, the given point group symmetry will be used.</span>
<span class="sd">            light_speed :</span>
<span class="sd">                If given, overwrite :attr:`Mole.light_speed`</span>

<span class="sd">        &#39;&#39;&#39;</span>
<span class="c"># release circular referred objs</span>
<span class="c"># Note obj.x = obj.member_function causes circular referrence</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">output</span>
        <span class="k">if</span> <span class="n">max_memory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_memory</span> <span class="o">=</span> <span class="n">max_memory</span>
        <span class="k">if</span> <span class="n">atom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">atom</span>
        <span class="k">if</span> <span class="n">basis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">basis</span>
        <span class="k">if</span> <span class="n">nucmod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nucmod</span> <span class="o">=</span> <span class="n">nucmod</span>
        <span class="k">if</span> <span class="n">mass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="n">mass</span>
        <span class="k">if</span> <span class="n">charge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">charge</span>
        <span class="k">if</span> <span class="n">spin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="n">spin</span>
        <span class="k">if</span> <span class="n">symmetry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="n">symmetry</span>
        <span class="k">if</span> <span class="n">symmetry_subgroup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_subgroup</span> <span class="o">=</span> <span class="n">symmetry_subgroup</span>
        <span class="k">if</span> <span class="n">light_speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_speed</span> <span class="o">=</span> <span class="n">light_speed</span>

        <span class="k">if</span> <span class="n">parse_arg</span><span class="p">:</span>
            <span class="n">_update_from_cmdargs_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># avoid to open output file twice</span>
        <span class="k">if</span> <span class="n">parse_arg</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> \
           <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_sanity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_atom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c"># specify global basis for whole molecule</span>
            <span class="n">uniq_atoms</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_basis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_basis</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>
                                                  <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">uniq_atoms</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_basis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_basis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basis</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pyscf.symm</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">symm</span><span class="o">.</span><span class="n">std_symb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span>
                <span class="n">orig</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">axes</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">groupname</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">symm</span><span class="o">.</span><span class="n">subgroup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">symm</span><span class="o">.</span><span class="n">check_given_symm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">_basis</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span><span class="p">,</span> <span class="n">orig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> \
                            <span class="n">pyscf</span><span class="o">.</span><span class="n">symm</span><span class="o">.</span><span class="n">detect_symm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basis</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Warn: unable to identify input symmetry </span><span class="si">%s</span><span class="s">,&#39;</span>
                                     <span class="s">&#39;use </span><span class="si">%s</span><span class="s"> instead.</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span>
                                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">groupname</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">symm</span><span class="o">.</span><span class="n">subgroup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span><span class="p">,</span> <span class="n">orig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> \
                        <span class="n">pyscf</span><span class="o">.</span><span class="n">symm</span><span class="o">.</span><span class="n">detect_symm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basis</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">groupname</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">symm</span><span class="o">.</span><span class="n">subgroup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry_subgroup</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_subgroup</span> <span class="o">=</span> \
                            <span class="n">pyscf</span><span class="o">.</span><span class="n">symm</span><span class="o">.</span><span class="n">std_symb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry_subgroup</span><span class="p">)</span>
                    <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry_subgroup</span> <span class="ow">in</span>
                           <span class="n">pyscf</span><span class="o">.</span><span class="n">symm</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">SUBGROUP</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">groupname</span><span class="p">])</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry_subgroup</span> <span class="o">==</span> <span class="s">&#39;Cs&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupname</span> <span class="o">==</span> <span class="s">&#39;C2v&#39;</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;TODO: rotate mirror or axes&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">groupname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry_subgroup</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_atom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="n">orig</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_LIGHT_SPEED</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">make_env</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">,</span> \
                              <span class="bp">self</span><span class="o">.</span><span class="n">nucmod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">natm</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbas</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nelectron</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tot_electrons</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nelectron</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">spin</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;Electron number </span><span class="si">%d</span><span class="s"> and spin </span><span class="si">%d</span><span class="s"> are not consistent</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span>
                               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nelectron</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pyscf.symm</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">eql_atoms</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">symm</span><span class="o">.</span><span class="n">symm_identical_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;&#39;&#39;Given symmetry and molecule structure not match.</span>
<span class="s">Note when symmetry attributes is assigned, the molecule needs to be put in the proper orientation.&#39;&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symm_orb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">irrep_id</span> <span class="o">=</span> \
                    <span class="n">pyscf</span><span class="o">.</span><span class="n">symm</span><span class="o">.</span><span class="n">symm_adapted_basis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupname</span><span class="p">,</span> <span class="n">eql_atoms</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basis</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">irrep_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">pyscf</span><span class="o">.</span><span class="n">symm</span><span class="o">.</span><span class="n">irrep_id2name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupname</span><span class="p">,</span> <span class="n">ir</span><span class="p">)</span>
                               <span class="k">for</span> <span class="n">ir</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">irrep_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">dump_input</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_built</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="n">logger</span><span class="o">.</span><span class="n">NOTE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump_input</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;arg.atm = </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;arg.bas = </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;arg.env = </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_built</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c">#return self._atm, self._bas, self._env</span>
</div>
    <span class="k">def</span> <span class="nf">format_atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">format_atom</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basis_tab</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">format_basis</span><span class="p">(</span><span class="n">basis_tab</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">expand_etb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">expand_etb</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">expand_etbs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">etbs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">expand_etbs</span><span class="p">(</span><span class="n">etbs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">pre_env</span><span class="o">=</span><span class="p">[],</span> <span class="n">nucmod</span><span class="o">=</span><span class="p">{},</span> <span class="n">mass</span><span class="o">=</span><span class="p">{}):</span>
        <span class="k">return</span> <span class="n">make_env</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">pre_env</span><span class="p">,</span> <span class="n">nucmod</span><span class="p">,</span> <span class="n">mass</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_atm_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom</span><span class="p">,</span> <span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">make_atm_env</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span> <span class="n">ptr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">make_bas_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basis_add</span><span class="p">,</span> <span class="n">atom_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ptr</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">make_bas_env</span><span class="p">(</span><span class="n">basis_add</span><span class="p">,</span> <span class="n">atom_id</span><span class="p">,</span> <span class="n">ptr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tot_electrons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tot_electrons</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gto_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">expnt</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">gto_norm</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">expnt</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">dump_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">__main__</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">__main__</span><span class="p">,</span> <span class="s">&#39;__file__&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__main__</span><span class="o">.</span><span class="n">__file__</span><span class="p">)</span>
                <span class="n">finput</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;INFO: **** input file is </span><span class="si">%s</span><span class="s"> ****</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">finput</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;INFO: ******************** input file end ********************</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">finput</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;input file does not exist&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;System: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">uname</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Date: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">())</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pyscfdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">__file__</span><span class="p">,</span> <span class="s">&#39;..&#39;</span><span class="p">,</span> <span class="s">&#39;..&#39;</span><span class="p">))</span>
            <span class="n">dn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pyscfdir</span><span class="p">,</span> <span class="s">&#39;.git&#39;</span><span class="p">,</span> <span class="s">&#39;refs&#39;</span><span class="p">,</span> <span class="s">&#39;heads&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;PySCF path  </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">pyscfdir</span><span class="p">)</span>
            <span class="c"># or command(git log -1 --pretty=%H)</span>
            <span class="n">version_msg</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="s">&#39;master&#39;</span><span class="p">,</span> <span class="s">&#39;dev&#39;</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dn</span><span class="p">,</span> <span class="n">branch</span><span class="p">),</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;GIT </span><span class="si">%s</span><span class="s"> branch  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">branch</span><span class="p">,</span> <span class="n">fin</span><span class="o">.</span><span class="n">readline</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;[INPUT] VERBOSE </span><span class="si">%d</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;[INPUT] light speed = </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_speed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;[INPUT] num atoms = </span><span class="si">%d</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">natm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;[INPUT] num electrons = </span><span class="si">%d</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nelectron</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;[INPUT] charge = </span><span class="si">%d</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;[INPUT] spin (= nelec alpha-beta = 2S) = </span><span class="si">%d</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ia</span><span class="p">,</span><span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">):</span>
            <span class="n">coorda</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">coordb</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">x</span><span class="o">/</span><span class="n">param</span><span class="o">.</span><span class="n">BOHR</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;[INPUT]</span><span class="si">%3d</span><span class="s"> </span><span class="si">%-4s</span><span class="s"> </span><span class="si">%16.12f</span><span class="s"> </span><span class="si">%16.12f</span><span class="s"> </span><span class="si">%16.12f</span><span class="s"> AA  &#39;</span>\
                              <span class="s">&#39;</span><span class="si">%16.12f</span><span class="s"> </span><span class="si">%16.12f</span><span class="s"> </span><span class="si">%16.12f</span><span class="s"> Bohr</span><span class="se">\n</span><span class="s">&#39;</span> \
                              <span class="o">%</span> <span class="p">((</span><span class="n">ia</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">_symbol</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="n">coorda</span> <span class="o">+</span> <span class="n">coordb</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">kn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nucmod</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">kn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="p">:</span>
                <span class="n">mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="p">[</span><span class="n">kn</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kn</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">symb</span> <span class="o">=</span> <span class="n">_symbol</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">kn</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">mass</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ELEMENTS</span><span class="p">[</span><span class="n">_charge</span><span class="p">(</span><span class="n">symb</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mass</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ELEMENTS</span><span class="p">[</span><span class="n">_charge</span><span class="p">(</span><span class="n">kn</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;[INPUT] Gaussian nuclear model for atom </span><span class="si">%s</span><span class="s">, mass = </span><span class="si">%f</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span>
                              <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">kn</span><span class="p">),</span> <span class="n">mass</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;[INPUT] ---------------- BASIS SET ---------------- </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;[INPUT] l, kappa, [nprim/nctr], &#39;</span> \
                          <span class="s">&#39;expnt,             c_1 c_2 ...</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">atom</span><span class="p">,</span> <span class="n">basis</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basis</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;[INPUT] </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">atom</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">basis</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">kappa</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">b_coeff</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kappa</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">b_coeff</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;[INPUT] </span><span class="si">%d</span><span class="s">   </span><span class="si">%2d</span><span class="s">    [</span><span class="si">%-5d</span><span class="s">/</span><span class="si">%-4d</span><span class="s">]  &#39;</span> \
                                  <span class="o">%</span> <span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">b_coeff</span><span class="o">.</span><span class="n">__len__</span><span class="p">(),</span> \
                                     <span class="n">b_coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">__len__</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">b_coeff</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%-15.12g</span><span class="s">  &#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">32</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%-15.12g</span><span class="s">  &#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; </span><span class="si">%4.12g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;nuclear repulsion = </span><span class="si">%.15g</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_nuc</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupname</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;point group symmetry = </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;point group symmetry = </span><span class="si">%s</span><span class="s">, use subgroup </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">topgroup</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupname</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ir</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symm_orb</span><span class="o">.</span><span class="n">__len__</span><span class="p">()):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;num. orbitals of irrep </span><span class="si">%s</span><span class="s"> = </span><span class="si">%d</span><span class="s">&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">irrep_name</span><span class="p">[</span><span class="n">ir</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">symm_orb</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;number of shells = </span><span class="si">%d</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nbas</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;number of NR pGTOs = </span><span class="si">%d</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">npgto_nr</span><span class="p">())</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;number of NR cGTOs = </span><span class="si">%d</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nao_nr</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="n">logger</span><span class="o">.</span><span class="n">DEBUG1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">)):</span>
                <span class="n">exps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bas_exp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;bas </span><span class="si">%d</span><span class="s">, expnt(s) = </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exps</span><span class="p">))</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;CPU time: </span><span class="si">%12.2f</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">())</span>

<div class="viewcode-block" id="Mole.set_common_origin_"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.set_common_origin_">[docs]</a>    <span class="k">def</span> <span class="nf">set_common_origin_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Update common origin which held in :class`Mole`._env.  **Note** the unit is Bohr</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.set_common_orig_(0)</span>
<span class="sd">        &gt;&gt;&gt; mol.set_common_orig_((1,0,0))</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_COMMON_ORIG</span><span class="p">:</span><span class="n">PTR_COMMON_ORIG</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord</span></div>
    <span class="k">def</span> <span class="nf">set_common_orig_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_common_origin_</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

<div class="viewcode-block" id="Mole.set_rinv_origin_"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.set_rinv_origin_">[docs]</a>    <span class="k">def</span> <span class="nf">set_rinv_origin_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">):</span>
        <span class="sd">r&#39;&#39;&#39;Update origin for operator :math:`\frac{1}{|r-R_O|}`.  **Note** the unit is Bohr</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.set_rinv_orig_(0)</span>
<span class="sd">        &gt;&gt;&gt; mol.set_rinv_orig_((0,1,0))</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">PTR_RINV_ORIG</span><span class="p">:</span><span class="n">PTR_RINV_ORIG</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span></div>
    <span class="k">def</span> <span class="nf">set_rinv_orig_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_rinv_origin_</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

<span class="c">#NOTE: atm_id or bas_id start from 0</span>
<div class="viewcode-block" id="Mole.atom_symbol"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.atom_symbol">[docs]</a>    <span class="k">def</span> <span class="nf">atom_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">):</span>
        <span class="sd">r&#39;&#39;&#39;For the given atom id, return the input symbol (without striping special characters)</span>

<span class="sd">        Args:</span>
<span class="sd">            atm_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H^2 0 0 0; H 0 0 1.1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.atom_symbol(0)</span>
<span class="sd">        H^2</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">_symbol</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">atm_id</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Mole.atom_pure_symbol"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.atom_pure_symbol">[docs]</a>    <span class="k">def</span> <span class="nf">atom_pure_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">):</span>
        <span class="sd">r&#39;&#39;&#39;For the given atom id, return the standard symbol (striping special characters)</span>

<span class="sd">        Args:</span>
<span class="sd">            atm_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H^2 0 0 0; H 0 0 1.1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.atom_symbol(0)</span>
<span class="sd">        H</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">_symbol</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_charge</span><span class="p">(</span><span class="n">atm_id</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Mole.atom_charge"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.atom_charge">[docs]</a>    <span class="k">def</span> <span class="nf">atom_charge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">):</span>
        <span class="sd">r&#39;&#39;&#39;Nuclear charge of the given atom id</span>

<span class="sd">        Args:</span>
<span class="sd">            atm_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.atom_charge(1)</span>
<span class="sd">        17</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[</span><span class="n">atm_id</span><span class="p">,</span><span class="n">CHARGE_OF</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mole.atom_coord"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.atom_coord">[docs]</a>    <span class="k">def</span> <span class="nf">atom_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">):</span>
        <span class="sd">r&#39;&#39;&#39;Coordinates (ndarray) of the given atom id</span>

<span class="sd">        Args:</span>
<span class="sd">            atm_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.atom_coord(1)</span>
<span class="sd">        [ 0.          0.          2.07869874]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[</span><span class="n">atm_id</span><span class="p">,</span><span class="n">PTR_COORD</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">ptr</span><span class="p">:</span><span class="n">ptr</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Mole.atom_nshells"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.atom_nshells">[docs]</a>    <span class="k">def</span> <span class="nf">atom_nshells</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">):</span>
        <span class="sd">r&#39;&#39;&#39;Number of basis/shells of the given atom</span>

<span class="sd">        Args:</span>
<span class="sd">            atm_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.atom_nshells(1)</span>
<span class="sd">        5</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">symb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_symbol</span><span class="p">(</span><span class="n">atm_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_basis</span><span class="p">[</span><span class="n">symb</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Mole.atom_shell_ids"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.atom_shell_ids">[docs]</a>    <span class="k">def</span> <span class="nf">atom_shell_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">):</span>
        <span class="sd">r&#39;&#39;&#39;A list of the shell-ids of the given atom</span>

<span class="sd">        Args:</span>
<span class="sd">            atm_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;, basis=&#39;cc-pvdz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.atom_nshells(1)</span>
<span class="sd">        [3, 4, 5, 6, 7]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[:,</span><span class="n">ATOM_OF</span><span class="p">]</span> <span class="o">==</span> <span class="n">atm_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mole.bas_coord"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.bas_coord">[docs]</a>    <span class="k">def</span> <span class="nf">bas_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
        <span class="sd">r&#39;&#39;&#39;Coordinates (ndarray) associated with the given basis id</span>

<span class="sd">        Args:</span>
<span class="sd">            bas_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.bas_coord(2)</span>
<span class="sd">        [ 0.          0.          2.07869874]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">atm_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bas_atom</span><span class="p">(</span><span class="n">bas_id</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">[</span><span class="n">atm_id</span><span class="p">,</span><span class="n">PTR_COORD</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">ptr</span><span class="p">:</span><span class="n">ptr</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Mole.bas_atom"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.bas_atom">[docs]</a>    <span class="k">def</span> <span class="nf">bas_atom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
        <span class="sd">r&#39;&#39;&#39;The atom (0-based id) that the given basis sits on</span>

<span class="sd">        Args:</span>
<span class="sd">            bas_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;, basis=&#39;cc-pvdz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.bas_atom(7)</span>
<span class="sd">        1</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id</span><span class="p">,</span><span class="n">ATOM_OF</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mole.bas_angular"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.bas_angular">[docs]</a>    <span class="k">def</span> <span class="nf">bas_angular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
        <span class="sd">r&#39;&#39;&#39;The angular momentum associated with the given basis</span>

<span class="sd">        Args:</span>
<span class="sd">            bas_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;, basis=&#39;cc-pvdz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.bas_atom(7)</span>
<span class="sd">        2</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id</span><span class="p">,</span><span class="n">ANG_OF</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mole.bas_nctr"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.bas_nctr">[docs]</a>    <span class="k">def</span> <span class="nf">bas_nctr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
        <span class="sd">r&#39;&#39;&#39;The number of contracted GTOs for the given shell</span>

<span class="sd">        Args:</span>
<span class="sd">            bas_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;, basis=&#39;cc-pvdz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.bas_atom(3)</span>
<span class="sd">        3</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id</span><span class="p">,</span><span class="n">NCTR_OF</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mole.bas_nprim"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.bas_nprim">[docs]</a>    <span class="k">def</span> <span class="nf">bas_nprim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
        <span class="sd">r&#39;&#39;&#39;The number of primitive GTOs for the given shell</span>

<span class="sd">        Args:</span>
<span class="sd">            bas_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;, basis=&#39;cc-pvdz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.bas_atom(3)</span>
<span class="sd">        11</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id</span><span class="p">,</span><span class="n">NPRIM_OF</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mole.bas_kappa"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.bas_kappa">[docs]</a>    <span class="k">def</span> <span class="nf">bas_kappa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
        <span class="sd">r&#39;&#39;&#39;Kappa (if l &lt; j, -l-1, else l) of the given shell</span>

<span class="sd">        Args:</span>
<span class="sd">            bas_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;, basis=&#39;cc-pvdz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.bas_kappa(3)</span>
<span class="sd">        0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id</span><span class="p">,</span><span class="n">KAPPA_OF</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mole.bas_exp"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.bas_exp">[docs]</a>    <span class="k">def</span> <span class="nf">bas_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
        <span class="sd">r&#39;&#39;&#39;exponents (ndarray) of the given shell</span>

<span class="sd">        Args:</span>
<span class="sd">            bas_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;, basis=&#39;cc-pvdz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.bas_kappa(0)</span>
<span class="sd">        [ 13.01     1.962    0.4446]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">nprim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bas_nprim</span><span class="p">(</span><span class="n">bas_id</span><span class="p">)</span>
        <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id</span><span class="p">,</span><span class="n">PTR_EXP</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">ptr</span><span class="p">:</span><span class="n">ptr</span><span class="o">+</span><span class="n">nprim</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mole.bas_ctr_coeff"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.bas_ctr_coeff">[docs]</a>    <span class="k">def</span> <span class="nf">bas_ctr_coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
        <span class="sd">r&#39;&#39;&#39;Contract coefficients (ndarray) of the given shell</span>

<span class="sd">        Args:</span>
<span class="sd">            bas_id : int</span>
<span class="sd">                0-based</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; Cl 0 0 1.1&#39;, basis=&#39;cc-pvdz&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.bas_ctr_coeff(3)</span>
<span class="sd">        [[ 0.34068924]</span>
<span class="sd">         [ 0.57789106]</span>
<span class="sd">         [ 0.65774031]]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">nprim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bas_nprim</span><span class="p">(</span><span class="n">bas_id</span><span class="p">)</span>
        <span class="n">nctr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bas_nctr</span><span class="p">(</span><span class="n">bas_id</span><span class="p">)</span>
        <span class="n">ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id</span><span class="p">,</span><span class="n">PTR_COEFF</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">[</span><span class="n">ptr</span><span class="p">:</span><span class="n">ptr</span><span class="o">+</span><span class="n">nprim</span><span class="o">*</span><span class="n">nctr</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nctr</span><span class="p">,</span><span class="n">nprim</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</div>
<div class="viewcode-block" id="Mole.bas_len_spinor"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.bas_len_spinor">[docs]</a>    <span class="k">def</span> <span class="nf">bas_len_spinor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The number of spinor associated with given basis</span>
<span class="sd">        If kappa is 0, return 4l+2</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bas_angular</span><span class="p">(</span><span class="n">bas_id</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bas_kappa</span><span class="p">(</span><span class="n">bas_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">len_spinor</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mole.bas_len_cart"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.bas_len_cart">[docs]</a>    <span class="k">def</span> <span class="nf">bas_len_cart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The number of Cartesian function associated with given basis</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">len_cart</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">[</span><span class="n">bas_id</span><span class="p">,</span><span class="n">ANG_OF</span><span class="p">])</span>

</div>
    <span class="k">def</span> <span class="nf">npgto_nr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">npgto_nr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">nao_nr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">nao_nr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">nao_nr_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id0</span><span class="p">,</span> <span class="n">bas_id1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">nao_nr_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id0</span><span class="p">,</span> <span class="n">bas_id1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">nao_2c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">nao_2c</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">nao_2c_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id0</span><span class="p">,</span> <span class="n">bas_id1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">nao_2c_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bas_id0</span><span class="p">,</span> <span class="n">bas_id1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ao_loc_nr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ao_loc_nr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ao_loc_2c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ao_loc_2c</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tmap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">time_reversal_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">time_reversal_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">time_reversal_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Mole.intor"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.intor">[docs]</a>    <span class="k">def</span> <span class="nf">intor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intor</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hermi</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;One-electron integral generator.</span>

<span class="sd">        Args:</span>
<span class="sd">            intor : str</span>
<span class="sd">                Name of the 1-electron integral.  Ref to :func:`getints` for the</span>
<span class="sd">                complete list of available 1-electron integral names</span>

<span class="sd">        Kwargs:</span>
<span class="sd">            comp : int</span>
<span class="sd">                Components of the integrals, e.g. cint1e_ipovlp has 3 components.</span>
<span class="sd">            hermi : int</span>
<span class="sd">                Symmetry of the integrals</span>

<span class="sd">                | 0 : no symmetry assumed (default)</span>
<span class="sd">                | 1 : hermitian</span>
<span class="sd">                | 2 : anti-hermitian</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray of 1-electron integrals, can be either 2-dim or 3-dim, depending on comp</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; H 0 0 1.1&#39;, basis=&#39;sto-3g&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.intor(&#39;cint1e_ipnuc_sph&#39;, comp=3) # &lt;nabla i | V_nuc | j&gt;</span>
<span class="sd">        [[[ 0.          0.        ]</span>
<span class="sd">          [ 0.          0.        ]]</span>
<span class="sd">         [[ 0.          0.        ]</span>
<span class="sd">          [ 0.          0.        ]]</span>
<span class="sd">         [[ 0.10289944  0.48176097]</span>
<span class="sd">          [-0.48176097 -0.10289944]]]</span>
<span class="sd">        &gt;&gt;&gt; mol.intor(&#39;cint1e_nuc&#39;)</span>
<span class="sd">        [[-1.69771092+0.j  0.00000000+0.j -0.67146312+0.j  0.00000000+0.j]</span>
<span class="sd">         [ 0.00000000+0.j -1.69771092+0.j  0.00000000+0.j -0.67146312+0.j]</span>
<span class="sd">         [-0.67146312+0.j  0.00000000+0.j -1.69771092+0.j  0.00000000+0.j]</span>
<span class="sd">         [ 0.00000000+0.j -0.67146312+0.j  0.00000000+0.j -1.69771092+0.j]]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">getints</span><span class="p">(</span><span class="n">intor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">,</span>
                                 <span class="n">comp</span><span class="o">=</span><span class="n">comp</span><span class="p">,</span> <span class="n">hermi</span><span class="o">=</span><span class="n">hermi</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mole.intor_symmetric"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.intor_symmetric">[docs]</a>    <span class="k">def</span> <span class="nf">intor_symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intor</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;One-electron integral generator. The integrals are assumed to be hermitian</span>

<span class="sd">        Args:</span>
<span class="sd">            intor : str</span>
<span class="sd">                Name of the 1-electron integral.  Ref to :func:`getints` for the</span>
<span class="sd">                complete list of available 1-electron integral names</span>

<span class="sd">        Kwargs:</span>
<span class="sd">            comp : int</span>
<span class="sd">                Components of the integrals, e.g. cint1e_ipovlp has 3 components.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray of 1-electron integrals, can be either 2-dim or 3-dim, depending on comp</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; H 0 0 1.1&#39;, basis=&#39;sto-3g&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.intor_symmetric(&#39;cint1e_nuc&#39;)</span>
<span class="sd">        [[-1.69771092+0.j  0.00000000+0.j -0.67146312+0.j  0.00000000+0.j]</span>
<span class="sd">         [ 0.00000000+0.j -1.69771092+0.j  0.00000000+0.j -0.67146312+0.j]</span>
<span class="sd">         [-0.67146312+0.j  0.00000000+0.j -1.69771092+0.j  0.00000000+0.j]</span>
<span class="sd">         [ 0.00000000+0.j -0.67146312+0.j  0.00000000+0.j -1.69771092+0.j]]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intor</span><span class="p">(</span><span class="n">intor</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mole.intor_asymmetric"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.intor_asymmetric">[docs]</a>    <span class="k">def</span> <span class="nf">intor_asymmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intor</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;One-electron integral generator. The integrals are assumed to be anti-hermitian</span>

<span class="sd">        Args:</span>
<span class="sd">            intor : str</span>
<span class="sd">                Name of the 1-electron integral.  Ref to :func:`getints` for the</span>
<span class="sd">                complete list of available 1-electron integral names</span>

<span class="sd">        Kwargs:</span>
<span class="sd">            comp : int</span>
<span class="sd">                Components of the integrals, e.g. cint1e_ipovlp has 3 components.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray of 1-electron integrals, can be either 2-dim or 3-dim, depending on comp</span>

<span class="sd">        Examples:</span>

<span class="sd">        &gt;&gt;&gt; mol.build(atom=&#39;H 0 0 0; H 0 0 1.1&#39;, basis=&#39;sto-3g&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.intor_asymmetric(&#39;cint1e_nuc&#39;)</span>
<span class="sd">        [[-1.69771092+0.j  0.00000000+0.j  0.67146312+0.j  0.00000000+0.j]</span>
<span class="sd">         [ 0.00000000+0.j -1.69771092+0.j  0.00000000+0.j  0.67146312+0.j]</span>
<span class="sd">         [-0.67146312+0.j  0.00000000+0.j -1.69771092+0.j  0.00000000+0.j]</span>
<span class="sd">         [ 0.00000000+0.j -0.67146312+0.j  0.00000000+0.j -1.69771092+0.j]]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intor</span><span class="p">(</span><span class="n">intor</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mole.intor_cross"><a class="viewcode-back" href="../../../gto.html#pyscf.gto.mole.Mole.intor_cross">[docs]</a>    <span class="k">def</span> <span class="nf">intor_cross</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intor</span><span class="p">,</span> <span class="n">bras</span><span class="p">,</span> <span class="n">kets</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">r&#39;&#39;&#39;1-electron integrals for different bra and ket space, like</span>

<span class="sd">        .. math::</span>

<span class="sd">            \langle \mu | intor | \nu \rangle, \mu \in bras, \nu \in kets</span>

<span class="sd">        Args:</span>
<span class="sd">            intor : str</span>
<span class="sd">                Name of the 1-electron integral.  Ref to :func:`getints` for the</span>
<span class="sd">                full list of available 1-electron integral names</span>
<span class="sd">            bras : list of int</span>
<span class="sd">                A list of shell ids for bra</span>
<span class="sd">            kets : list of int</span>
<span class="sd">                A list of shell ids for ket</span>

<span class="sd">        Kwargs:</span>
<span class="sd">            comp : int</span>
<span class="sd">                Components of the integrals, e.g. cint1e_ipovlp has 3 components</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray of 1-electron integrals, can be either 2-dim or 3-dim, depending on comp</span>

<span class="sd">        Examples:</span>
<span class="sd">            Compute the overlap between H2 molecule and O atom</span>

<span class="sd">        &gt;&gt;&gt; mol = gto.M(atom=&#39;O 0 0 0; H 0 1 0; H 0 0 1&#39;, basis=&#39;sto3g&#39;)</span>
<span class="sd">        &gt;&gt;&gt; mol.intor_cross(&#39;cint1e_ovlp_sph&#39;, range(0,3), range(3,5))</span>
<span class="sd">        [[ 0.04875181  0.04875181]</span>
<span class="sd">         [ 0.44714688  0.44714688]</span>
<span class="sd">         [ 0.          0.        ]</span>
<span class="sd">         [ 0.37820346  0.        ]</span>
<span class="sd">         [ 0.          0.37820346]]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">getints</span><span class="p">(</span><span class="n">intor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">,</span>
                                 <span class="n">bras</span><span class="p">,</span> <span class="n">kets</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">intor_by_shell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intor</span><span class="p">,</span> <span class="n">shells</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">moleintor</span><span class="o">.</span><span class="n">getints_by_shell</span><span class="p">(</span><span class="n">intor</span><span class="p">,</span> <span class="n">shells</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bas</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">energy_nuc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">energy_nuc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_enuc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">energy_nuc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cart_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cart_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">spheric_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">spheric_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">search_shell_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">search_shell_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">search_ao_nr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">atmshell</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">search_ao_nr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">atmshell</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">search_ao_r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">atmshell</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">search_ao_r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atm_id</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">atmshell</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">spinor_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">spinor_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
<span class="n">_ELEMENTDIC</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">param</span><span class="o">.</span><span class="n">ELEMENTS_PROTON</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">_rm_digit</span><span class="p">(</span><span class="n">symb</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">symb</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">symb</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">symb</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()])</span>

<span class="k">def</span> <span class="nf">_charge</span><span class="p">(</span><span class="n">symb_or_chg</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">symb_or_chg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">param</span><span class="o">.</span><span class="n">ELEMENTS_PROTON</span><span class="p">[</span><span class="n">_rm_digit</span><span class="p">(</span><span class="n">symb_or_chg</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">symb_or_chg</span>

<span class="k">def</span> <span class="nf">_symbol</span><span class="p">(</span><span class="n">symb_or_chg</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">symb_or_chg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">symb_or_chg</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">param</span><span class="o">.</span><span class="n">ELEMENTS</span><span class="p">[</span><span class="n">symb_or_chg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">_std_symbol</span><span class="p">(</span><span class="n">symb_or_chg</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">symb_or_chg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">rawsymb</span> <span class="o">=</span> <span class="n">_rm_digit</span><span class="p">(</span><span class="n">symb_or_chg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">param</span><span class="o">.</span><span class="n">ELEMENTS</span><span class="p">[</span><span class="n">_ELEMENTDIC</span><span class="p">[</span><span class="n">rawsymb</span><span class="o">.</span><span class="n">upper</span><span class="p">()]][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">param</span><span class="o">.</span><span class="n">ELEMENTS</span><span class="p">[</span><span class="n">symb_or_chg</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">_parse_nuc_mod</span><span class="p">(</span><span class="n">str_or_int</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">str_or_int</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">str_or_int</span>
    <span class="k">elif</span> <span class="s">&#39;G&#39;</span> <span class="ow">in</span> <span class="n">str_or_int</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="c"># &#39;gauss_nuc&#39;</span>
        <span class="k">return</span> <span class="n">NUC_GAUSS</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">NUC_POINT</span>

<span class="k">def</span> <span class="nf">_update_from_cmdargs_</span><span class="p">(</span><span class="n">mol</span><span class="p">):</span>
    <span class="c"># Ipython shell conflicts with optparse</span>
    <span class="c"># pass sys.args when using ipython</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">__IPYTHON__</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Warn: Ipython shell catchs sys.args</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">mol</span><span class="o">.</span><span class="n">_built</span><span class="p">:</span> <span class="c"># parse cmdline args only once</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="n">cmd_args</span><span class="o">.</span><span class="n">cmd_args</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">max_memory</span><span class="p">:</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">max_memory</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">max_memory</span>

        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">output</span>

    <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">output</span><span class="p">):</span>
            <span class="c">#os.remove(mol.output)</span>
            <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="n">logger</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;overwrite output file: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">mol</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="n">logger</span><span class="o">.</span><span class="n">QUIET</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;output file: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">mol</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">from_zmatrix</span><span class="p">(</span><span class="n">atomstr</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">pyscf.symm</span>
    <span class="n">atomstr</span> <span class="o">=</span> <span class="n">atomstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">)</span>
    <span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">atomstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">rawd</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rawd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rawd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rawd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rawd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">rawd</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rawd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">bonda</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rawd</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">bond</span>  <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rawd</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">anga</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rawd</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">ang</span>   <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rawd</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">v1</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">[</span><span class="n">anga</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">atoms</span><span class="p">[</span><span class="n">bonda</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">v1</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">vecn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span> <span class="c"># on z</span>
                    <span class="n">vecn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">))</span>
                <span class="n">rmat</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">symm</span><span class="o">.</span><span class="n">rotation_mat</span><span class="p">(</span><span class="n">vecn</span><span class="p">,</span> <span class="n">ang</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rmat</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">bond</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v1</span><span class="p">))</span>
                <span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rawd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">atoms</span><span class="p">[</span><span class="n">bonda</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span> <span class="c"># FIXME</span>
                <span class="n">bonda</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rawd</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">bond</span>  <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rawd</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">anga</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rawd</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">ang</span>   <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rawd</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">diha</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rawd</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">dih</span>   <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rawd</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">v1</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">[</span><span class="n">anga</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">atoms</span><span class="p">[</span><span class="n">bonda</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">v2</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">[</span><span class="n">diha</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">atoms</span><span class="p">[</span><span class="n">anga</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">vecn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="o">-</span><span class="n">v1</span><span class="p">)</span>
                <span class="n">rmat</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">symm</span><span class="o">.</span><span class="n">rotation_mat</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="o">-</span><span class="n">dih</span><span class="p">)</span>
                <span class="n">vecn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rmat</span><span class="p">,</span> <span class="n">vecn</span><span class="p">)</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vecn</span><span class="p">)</span>
                <span class="n">rmat</span> <span class="o">=</span> <span class="n">pyscf</span><span class="o">.</span><span class="n">symm</span><span class="o">.</span><span class="n">rotation_mat</span><span class="p">(</span><span class="n">vecn</span><span class="p">,</span> <span class="n">ang</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rmat</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">bond</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v1</span><span class="p">))</span>
                <span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rawd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">atoms</span><span class="p">[</span><span class="n">bonda</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">c</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">atoms</span>
<span class="n">zmat</span> <span class="o">=</span> <span class="n">from_zmatrix</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PySCF 1.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Qiming Sun &lt;osirpt.sun@gmail.com&gt;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>